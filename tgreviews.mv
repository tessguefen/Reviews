<MIVA STANDARDOUTPUTLEVEL = "">

<MvCOMMENT>
|
| Prefix         : MOD-SYS-TGR-
| Next Error Code: 1
|
</MvCOMMENT>

<MvFUNCTION NAME = "Module_Description" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.module:code"		VALUE = "tgreviews">
	<MvASSIGN NAME = "l.module:name"		VALUE = "Product Reviews">
	<MvASSIGN NAME = "l.module:provider"	VALUE = "Tess Guefen">
	<MvASSIGN NAME = "l.module:version"		VALUE = "2.000">
	<MvASSIGN NAME = "l.module:api_ver"		VALUE = "9.12">
	<MvASSIGN NAME = "l.module:description"	VALUE = "Product Reviews module allows your customers to easily write reviews for products. This module also allows for importing and exporting product reviews.">
	<MvASSIGN NAME = "l.module:features"	VALUE = "data_store, system, vis_system, json, clientside, component, fields_prod, not_prod, fulfill, scheduledtask, vis_product, export, import, json_api">
</MvFUNCTION>

<MvCOMMENT>
|
| Feature: data_store
|
</MvCOMMENT>

<MvFUNCTION NAME = "Module_Install_Store" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvCOMMENT>
	|
	|	sNN_TGReviewsGeneralSettings
	|
	</MvCOMMENT>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsGeneralSettings
							(
								fld_name	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
								fld_email	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
								fld_loc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
								fld_summry	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
								fld_title	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
								per_page	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								sort		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )		$ ',
								auto_apprv	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
								rc_enabled	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
								rc_pub_key	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								rc_prv_key	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ '
							)' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.general_settings:fld_name"		VALUE = 1>
	<MvASSIGN NAME = "l.general_settings:fld_email"		VALUE = 1>
	<MvASSIGN NAME = "l.general_settings:fld_loc"		VALUE = 0>
	<MvASSIGN NAME = "l.general_settings:fld_summry"	VALUE = 1>
	<MvASSIGN NAME = "l.general_settings:fld_title"		VALUE = 1>
	<MvASSIGN NAME = "l.general_settings:per_page"		VALUE = 5>
	<MvASSIGN NAME = "l.general_settings:sort"			VALUE = "-id">
	<MvASSIGN NAME = "l.general_settings:auto_apprv"	VALUE = 0>
	<MvASSIGN NAME = "l.general_settings:rc_enabled"	VALUE = 0>
	<MvASSIGN NAME = "l.general_settings:rc_pub_key"	VALUE = "">
	<MvASSIGN NAME = "l.general_settings:rc_prv_key"	VALUE = "">

	<MvIF EXPR = "{ NOT TGReviewsGeneralSettings_Insert( l.general_settings ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	|	sNN_TGReviewsNotificationSettings
	|
	</MvCOMMENT>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsNotificationSettings
							(
								ma_enable	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
								ma_days		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								ma_after	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )		$ ',
								ma_from		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								ma_cc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								ma_bcc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								ma_subject	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								mn_enable	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
								mn_to		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								mn_from		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								mn_cc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								mn_bcc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								mn_subject	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								cn_from		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								cn_cc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								cn_bcc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
								cn_subject	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ '
							)' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.email_settings:ma_enable"	VALUE = 0>
	<MvASSIGN NAME = "l.email_settings:ma_days"		VALUE = 7>
	<MvASSIGN NAME = "l.email_settings:ma_after"	VALUE = "order">
	<MvASSIGN NAME = "l.email_settings:ma_from"		VALUE = "{ g.Store:email }">
	<MvASSIGN NAME = "l.email_settings:ma_cc"		VALUE = "">
	<MvASSIGN NAME = "l.email_settings:ma_bcc"		VALUE = "">
	<MvASSIGN NAME = "l.email_settings:ma_subject"	VALUE = "{ 'Please Review Your Recent Purchase on ' $ g.Store:name }">
	<MvASSIGN NAME = "l.email_settings:mn_enable"	VALUE = 0>
	<MvASSIGN NAME = "l.email_settings:mn_to"		VALUE = "{ g.Store:email }">
	<MvASSIGN NAME = "l.email_settings:mn_from"		VALUE = "{ g.Store:email }">
	<MvASSIGN NAME = "l.email_settings:mn_cc"		VALUE = "">
	<MvASSIGN NAME = "l.email_settings:mn_bcc"		VALUE = "">
	<MvASSIGN NAME = "l.email_settings:mn_subject"	VALUE = "{ 'You have Received a Product Review on ' $ g.Store:name }">
	<MvASSIGN NAME = "l.email_settings:cn_from"		VALUE = "{ g.Store:email }">
	<MvASSIGN NAME = "l.email_settings:cn_cc"		VALUE = "">
	<MvASSIGN NAME = "l.email_settings:cn_bcc"		VALUE = "">
	<MvASSIGN NAME = "l.email_settings:cn_subject"	VALUE = "{ 'Your Recent Product Review on ' $ g.Store:name }">

	<MvIF EXPR = "{ NOT TGReviewsNotificationSettings_Insert( l.email_settings ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	|	sNN_TGReviewsTemplates
	|
	</MvCOMMENT>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsTemplates
							(
								ma_tmpl_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								mn_tmpl_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								cn_tmpl_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								form_tmpl	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								rvws_tmpl	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								prlog_tmpl	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ '
							)' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_Item( 'tgreviews', l.module:code ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.Error_Message ) }">
	</MvIF>

	<MvCOMMENT>
	|
	|	ma_tmpl_id: TGR_MailAfter_Email
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.ma_template:admin"		VALUE = 1>
	<MvASSIGN NAME = "l.ma_template:code"		VALUE = "TGR_MailAfter_Email">
	<MvASSIGN NAME = "l.ma_template:name"		VALUE = "Reviews Email Template: Mail After">
	<MvASSIGN NAME = "l.ma_template:ui_id"		VALUE = "{ l.module:id }">
	<MvASSIGN NAME = "l.ma_template:settings"	VALUE = "">

	<MvCAPTURE VARIABLE = "l.ma_template_data">
		<MvINCLUDE FILE = "templates/TGR_MailAfter_Email.mvt" INTERPRET = "OFF">
	</MvCAPTURE>

	<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_Page_LowLevel( l.ma_template, l.ma_template_data ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Page_Assign_Item( l.ma_template, 'store' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Page_Assign_Item( l.ma_template, 'urls' ) }">

	<MvCOMMENT>
	|
	|	mn_tmpl_id: TGR_Merchant_Email
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.mn_template:admin"		VALUE = 1>
	<MvASSIGN NAME = "l.mn_template:code"		VALUE = "TGR_Merchant_Email">
	<MvASSIGN NAME = "l.mn_template:name"		VALUE = "Reviews Email Template: Merchant Notification">
	<MvASSIGN NAME = "l.mn_template:ui_id"		VALUE = "{ l.module:id }">
	<MvASSIGN NAME = "l.mn_template:settings"	VALUE = "">

	<MvCAPTURE VARIABLE = "l.mn_template_data">
		<MvINCLUDE FILE = "templates/TGR_Merchant_Email.mvt" INTERPRET = "OFF">
	</MvCAPTURE>

	<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_Page_LowLevel( l.mn_template, l.mn_template ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Page_Assign_Item( l.mn_template, 'store' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Page_Assign_Item( l.mn_template, 'urls' ) }">

	<MvCOMMENT>
	|
	|	mc_tmpl_id: TGR_Merchant_Email
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.cn_template:admin"		VALUE = 1>
	<MvASSIGN NAME = "l.cn_template:code"		VALUE = "TGR_Customer_Email">
	<MvASSIGN NAME = "l.cn_template:name"		VALUE = "Reviews Email Template: Customer Notification">
	<MvASSIGN NAME = "l.cn_template:ui_id"		VALUE = "{ l.module:id }">
	<MvASSIGN NAME = "l.cn_template:settings"	VALUE = "">

	<MvCAPTURE VARIABLE = "l.cn_template_data">
		<MvINCLUDE FILE = "templates/TGR_Customer_Email.mvt" INTERPRET = "OFF">
	</MvCAPTURE>

	<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_Page_LowLevel( l.cn_template, l.cn_template ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Page_Assign_Item( l.cn_template, 'store' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Page_Assign_Item( l.cn_template, 'urls' ) }">

	<MvCOMMENT>
	|
	|	form_tmpl: Form Template
	|
	</MvCOMMENT>

	<MvCAPTURE VARIABLE = "l.form_template_code">
		<MvINCLUDE FILE = "templates/tgr_form.mvt" INTERPRET = "OFF">
	</MvCAPTURE>

	<MvASSIGN NAME = "l.form_settings"			VALUE = "">
	<MvASSIGN NAME = "l.templates:form_tmpl"	VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_ManagedTemplate( l.form_template_code, l.form_settings, 'tgr_form.mvc' ) }">

	<MvIF EXPR = "{ NOT l.templates:form_tmpl }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	|	rvws_tmpl: Reviews Template
	|
	</MvCOMMENT>

	<MvCAPTURE VARIABLE = "l.reviews_template_code">
		<MvINCLUDE FILE = "templates/tgr_reviews.mvt" INTERPRET = "OFF">
	</MvCAPTURE>

	<MvASSIGN NAME = "l.review_settings"		VALUE = "">
	<MvASSIGN NAME = "l.templates:rvws_tmpl"	VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_ManagedTemplate( l.reviews_template_code, l.review_settings, 'tgr_reviews.mvc' ) }">

	<MvIF EXPR = "{ NOT l.templates:rvws_tmpl }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	|	prlog_tmpl: Pre-Submission Logic
	|
	</MvCOMMENT>

	<MvCAPTURE VARIABLE = "l.prelogic_template_code">
		<MvINCLUDE FILE = "templates/tgr_prelogic.mvt" INTERPRET = "OFF">
	</MvCAPTURE>

	<MvASSIGN NAME = "l.prelogic_settings"		VALUE = "">
	<MvASSIGN NAME = "l.templates:prlog_tmpl"	VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_ManagedTemplate( l.prelogic_template_code, l.prelogic_settings, 'tgr_prelogic.mvc' ) }">

	<MvIF EXPR = "{ NOT l.templates:prlog_tmpl }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.templates:ma_tmpl_id"	VALUE = "{ l.ma_template:id }">
	<MvASSIGN NAME = "l.templates:mn_tmpl_id"	VALUE = "{ l.mn_template:id }">
	<MvASSIGN NAME = "l.templates:cn_tmpl_id"	VALUE = "{ l.cn_template:id }">

	<MvIF EXPR = "{ NOT TGReviewsTemplates_Insert( l.templates ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMENT>
	|
	|	sNN_TGReviewsProducts
	|
	</MvCOMMENT>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsProducts
							(
								id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								created		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								product_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								cust_id		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								order_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								approved	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
								rating		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								name		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 255 ) 		$ ',
								email		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 255 ) 		$ ',
								location	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 255 ) 		$ ',
								notify		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()	 		$ ',
								title		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 255 ) 		$ ',
								summary		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()			$ ',
								store_rply	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO()			$ ',
								notified	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								verified	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ '
							)' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME	= "Merchant"
				QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'TGReviewsProducts_1 ON ' $ g.Store_Table_Prefix $ 'TGReviewsProducts ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY NAME = "Merchant"
			 QUERY = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'TGReviewsProducts_2 ON ' $ g.Store_Table_Prefix $ 'TGReviewsProducts ( product_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	|	sNN_TGReviewsAdditionalFields
	|
	</MvCOMMENT>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields
							(
								id			' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								code		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 255 )		$ ',
								name		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 255 )		$ '
							)' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME	= "Merchant"
				QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields_1 ON ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields ( id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME	= "Merchant"
				QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields_2 ON ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields ( code )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	|	sNN_TGReviewsAdditionalValues
	|
	</MvCOMMENT>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues
							(
								field_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								review_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
								value		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 255 )		$ '
							)' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME	= "Merchant"
				QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues_1 ON ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues ( field_id, review_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>


	<MvCOMMENT>
	|
	|	sNN_TGReviewsOrders
	|
	</MvCOMMENT>

	<MvQUERY	NAME = "Merchant"
				QUERY = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsOrders
							(
								order_id ' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 ) $ '
							)' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvQUERY	NAME	= "Merchant"
				QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'TGReviewsOrders_1 ON ' $ g.Store_Table_Prefix $ 'TGReviewsOrders ( order_id )' }">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvCOMMENT>
	|
	|	StoreKeys
	|	TGRProduct, TGRAdditional
	|
	</MvCOMMENT>

	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].StoreKey_Insert( 'TGRProduct',		1 ) OR
					NOT [ g.Module_Library_DB ].StoreKey_Insert( 'TGRAdditional',	1 ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Upgrade_Store" PARAMETERS = "module var, version" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.version LT 1.002 }">
		<MvCOMMENT>
		|
		|	Change `store_reply` to `store_rply` for MivaSQL
		|
		</MvCOMMENT>

		<MvQUERY NAME	= "Merchant"
				 QUERY	= "{ 'ALTER TABLE ' $ g.Store_Table_Prefix $ 'TGReviews_Products CHANGE store_reply store_rply ' $ [ g.Module_Library_Native_DBAPI ].DB_Type_MEMO() }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', 'Could not Rename store_reply to store_rply' ) }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ l.version LT 2.000 }">
		<MvCOMMENT>
		|
		|	Upgrade path for 2.000
		|
		</MvCOMMENT>

		<MvCOMMENT>
		|
		|	sNN_TGReviewsGeneralSettings
		|
		</MvCOMMENT>

		<MvQUERY	NAME = "Merchant"
					QUERY = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsGeneralSettings
								(
									fld_name	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
									fld_email	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
									fld_loc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
									fld_summry	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
									fld_title	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
									per_page	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
									sort		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )		$ ',
									auto_apprv	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
									rc_enabled	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
									rc_pub_key	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									rc_prv_key	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ '
								)' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>

		<MvCOMMENT>
		|
		|	sNN_TGReviewsNotificationSettings
		|
		</MvCOMMENT>

		<MvQUERY	NAME = "Merchant"
					QUERY = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsNotificationSettings
								(
									ma_enable	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
									ma_days		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
									ma_after	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 50 )		$ ',
									ma_from		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									ma_cc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									ma_bcc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									ma_subject	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									mn_enable	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_BOOL()			$ ',
									mn_to		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									mn_from		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									mn_cc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									mn_bcc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									mn_subject	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									cn_from		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									cn_cc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									cn_bcc		' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ ',
									cn_subject	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_CHAR( 254 )		$ '
								)' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>

		<MvCOMMENT>
		|
		|	sNN_TGReviewsTemplates
		|
		</MvCOMMENT>

		<MvQUERY	NAME = "Merchant"
					QUERY = "{ 'CREATE TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsTemplates
								(
									ma_tmpl_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
									mn_tmpl_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
									cn_tmpl_id	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
									form_tmpl	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
									rvws_tmpl	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ ',
									prlog_tmpl	' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 )	$ '
								)' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>

		<MvASSIGN NAME = "l.previous_settings"	VALUE = "">

		<MvOPENVIEW NAME	= "Merchant"
					VIEW 	= "TGReviews_Settings"
					QUERY 	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'TGReviews_Settings' }">
		<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvOPENVIEW_Error ) }">
		</MvIF>

		<MvASSIGN NAME = "l.count" VALUE = 0>

		<MvWHILE EXPR = "{ NOT TGReviews_Settings.d.EOF }">
			<MvASSIGN NAME = "l.previous_settings" MEMBER = "{ TGReviews_Settings.d.name }" VALUE = "{ TGReviews_Settings.d.value }">

			<MvSKIP NAME = "Merchant" VIEW = "TGReviews_Settings" ROWS = 1>
		</MvWHILE>

		<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviews_Settings">

		<MvASSIGN NAME = "l.previous_settings:required"			VALUE = "{ miva_array_deserialize( l.previous_settings:required ) }">
		<MvASSIGN NAME = "l.previous_settings:recaptcha"		VALUE = "{ miva_array_deserialize( l.previous_settings:recaptcha ) }">
		<MvASSIGN NAME = "l.previous_settings:mail_after"		VALUE = "{ miva_array_deserialize( l.previous_settings:mail_after ) }">
		<MvASSIGN NAME = "l.previous_settings:merchant_email"	VALUE = "{ miva_array_deserialize( l.previous_settings:merchant_email ) }">
		<MvASSIGN NAME = "l.previous_settings:customer_email"	VALUE = "{ miva_array_deserialize( l.previous_settings:customer_email ) }">

		<MvCOMMENT>
		|
		|	Copy over General Settings
		|
		</MvCOMMENT>

		<MvASSIGN NAME = "l.general_settings:fld_name"		VALUE = "{ [ g.Module_Admin ].Trim_Boolean( l.previous_settings:required:name ) }">
		<MvASSIGN NAME = "l.general_settings:fld_email"		VALUE = "{ [ g.Module_Admin ].Trim_Boolean( l.previous_settings:required:email ) }">
		<MvASSIGN NAME = "l.general_settings:fld_loc"		VALUE = "{ [ g.Module_Admin ].Trim_Boolean( l.previous_settings:required:location ) }">
		<MvASSIGN NAME = "l.general_settings:fld_summry"	VALUE = "{ [ g.Module_Admin ].Trim_Boolean( l.previous_settings:required:summary ) }">
		<MvASSIGN NAME = "l.general_settings:fld_title"		VALUE = "{ [ g.Module_Admin ].Trim_Boolean( l.previous_settings:required:title ) }">
		<MvASSIGN NAME = "l.general_settings:per_page"		VALUE = "{ int( l.previous_settings:reviews_per_page ) }">
		<MvASSIGN NAME = "l.general_settings:sort"			VALUE = "{ l.previous_settings:reviews_default_sorting }">
		<MvASSIGN NAME = "l.general_settings:auto_apprv"	VALUE = "{ [ g.Module_Admin ].Trim_Boolean( l.previous_settings:auto_approve ) }">
		<MvASSIGN NAME = "l.general_settings:rc_enabled"	VALUE = "{ [ g.Module_Admin ].Trim_Boolean( l.previous_settings:recaptcha:enable ) }">
		<MvASSIGN NAME = "l.general_settings:rc_pub_key"	VALUE = "{ l.previous_settings:recaptcha:public_key }">
		<MvASSIGN NAME = "l.general_settings:rc_prv_key"	VALUE = "{ l.previous_settings:recaptcha:private_key }">

		<MvIF EXPR = "{ NOT TGReviewsGeneralSettings_Insert( l.general_settings ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvCOMMENT>
		|
		|	Copy over Email Settings
		|
		</MvCOMMENT>

		<MvASSIGN NAME = "l.email_settings:ma_enable"	VALUE = "{ [ g.Module_Admin ].Trim_Boolean( l.previous_settings:mail_after:notify ) }">
		<MvASSIGN NAME = "l.email_settings:ma_days"		VALUE = "{ int( l.previous_settings:mail_after:days ) }">
		<MvASSIGN NAME = "l.email_settings:ma_after"	VALUE = "{ l.previous_settings:mail_after:after }">
		<MvASSIGN NAME = "l.email_settings:ma_from"		VALUE = "{ l.previous_settings:mail_after:from }">
		<MvASSIGN NAME = "l.email_settings:ma_cc"		VALUE = "{ l.previous_settings:mail_after:cc }">
		<MvASSIGN NAME = "l.email_settings:ma_bcc"		VALUE = "{ l.previous_settings:mail_after:bcc }">
		<MvASSIGN NAME = "l.email_settings:ma_subject"	VALUE = "{ l.previous_settings:mail_after:subject }">
		<MvASSIGN NAME = "l.email_settings:mn_enable"	VALUE = "{ [ g.Module_Admin ].Trim_Boolean( l.previous_settings:merchant_email:notify ) }">
		<MvASSIGN NAME = "l.email_settings:mn_to"		VALUE = "{ l.previous_settings:merchant_email:to }">
		<MvASSIGN NAME = "l.email_settings:mn_from"		VALUE = "{ l.previous_settings:merchant_email:from }">
		<MvASSIGN NAME = "l.email_settings:mn_cc"		VALUE = "{ l.previous_settings:merchant_email:cc }">
		<MvASSIGN NAME = "l.email_settings:mn_bcc"		VALUE = "{ l.previous_settings:merchant_email:bcc }">
		<MvASSIGN NAME = "l.email_settings:mn_subject"	VALUE = "{ l.previous_settings:merchant_email:subject }">
		<MvASSIGN NAME = "l.email_settings:cn_from"		VALUE = "{ l.previous_settings:customer_email:from }">
		<MvASSIGN NAME = "l.email_settings:cn_cc"		VALUE = "{ l.previous_settings:customer_email:cc }">
		<MvASSIGN NAME = "l.email_settings:cn_bcc"		VALUE = "{ l.previous_settings:customer_email:bcc }">
		<MvASSIGN NAME = "l.email_settings:cn_subject"	VALUE = "{ l.previous_settings:customer_email:subject }">

		<MvIF EXPR = "{ NOT TGReviewsNotificationSettings_Insert( l.email_settings ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvCOMMENT>
		|
		|	prlog_tmpl: Pre-Submission Logic
		|
		</MvCOMMENT>

		<MvCAPTURE VARIABLE = "l.prelogic_template_code">
			<MvINCLUDE FILE = "templates/tgr_prelogic.mvt" INTERPRET = "OFF">
		</MvCAPTURE>

		<MvASSIGN NAME = "l.prelogic_settings"		VALUE = "">
		<MvASSIGN NAME = "l.templates:prlog_tmpl"	VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_ManagedTemplate( l.prelogic_template_code, l.prelogic_settings, 'tgr_prelogic.mvc' ) }">

		<MvIF EXPR = "{ NOT l.templates:prlog_tmpl }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_DB ].Page_Load_Code( 'TGR_MailAfter_Email', l.mail_after_page ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvASSIGN NAME = "l.mail_after_page:admin"	VALUE = 1>
		<MvASSIGN NAME = "l.mail_after_page:ui_id"	VALUE = "{ l.module:id }">

		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_DB ].Page_Update( l.mail_after_page ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_DB ].Page_Load_Code( 'TGR_Merchant_Email', l.merchant_notification_page ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvASSIGN NAME = "l.merchant_notification_page:admin"	VALUE = 1>
		<MvASSIGN NAME = "l.merchant_notification_page:ui_id"	VALUE = "{ l.module:id }">

		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_DB ].Page_Update( l.merchant_notification_page ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_DB ].Page_Load_Code( 'TGR_Customer_Email', l.customer_notification_page ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvASSIGN NAME = "l.customer_notification_page:admin"	VALUE = 1>
		<MvASSIGN NAME = "l.customer_notification_page:ui_id"	VALUE = "{ l.module:id }">

		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_DB ].Page_Update( l.customer_notification_page ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvASSIGN NAME = "l.templates:form_tmpl"	VALUE = "{ l.previous_settings:form_template }">
		<MvASSIGN NAME = "l.templates:rvws_tmpl"	VALUE = "{ l.previous_settings:reviews_template }">
		<MvASSIGN NAME = "l.templates:mn_tmpl_id"	VALUE = "{ l.merchant_notification_page:templ_id }">
		<MvASSIGN NAME = "l.templates:ma_tmpl_id"	VALUE = "{ l.mail_after_page:templ_id }">
		<MvASSIGN NAME = "l.templates:cn_tmpl_id"	VALUE = "{ l.customer_notification_page:templ_id }">

		<MvIF EXPR = "{ NOT TGReviewsTemplates_Insert( l.templates ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'TGReviews_Settings' }">

		<MvCOMMENT>
		|
		|	Rename sNN_TGReviews_Products to sNN_TGReviewsProducts
		|	Update Indexes
		|
		</MvCOMMENT>

		<MvQUERY	NAME = "Merchant"
					QUERY = "{ 'RENAME TABLE ' $ g.Store_Table_Prefix $ 'TGReviews_Products TO ' $ g.Store_Table_Prefix $ 'TGReviewsProducts' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>

		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'TGReviewsProducts', g.Store_Table_Prefix $ 'TGReviews_Products' ) }">

		<MvQUERY	NAME	= "Merchant"
					QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'TGReviewsProducts_1 ON ' $ g.Store_Table_Prefix $ 'TGReviewsProducts ( id )' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>

		<MvQUERY	NAME = "Merchant"
					QUERY = "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'TGReviewsProducts_2 ON ' $ g.Store_Table_Prefix $ 'TGReviewsProducts ( product_id )' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>

		<MvCOMMENT>
		|
		|	Rename sNN_TGReviews_AdditionalFields to sNN_TGReviewsAdditionalFields
		|	Update Indexes
		|
		</MvCOMMENT>

		<MvQUERY NAME = "Merchant"
				 QUERY = "{ 'RENAME TABLE ' $ g.Store_Table_Prefix $ 'TGReviews_AdditionalFields TO ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>

		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'TGReviewsAdditionalFields', g.Store_Table_Prefix $ 'TGReviews_AdditionalFields' ) }">

		<MvQUERY	NAME	= "Merchant"
					QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields_1 ON ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields ( id )' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>

		<MvQUERY	NAME	= "Merchant"
					QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields_2 ON ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields ( code )' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>
		
		<MvCOMMENT>
		|
		|	Rename sNN_TGReviews_AdditionalValues to sNN_TGReviewsAdditionalValues
		|	Rename rating_id to review_id
		|	Update Indexes
		|
		</MvCOMMENT>

		<MvQUERY NAME = "Merchant"
				 QUERY = "{ 'RENAME TABLE ' $ g.Store_Table_Prefix $ 'TGReviews_AdditionalValues TO ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>

		<MvQUERY NAME = "Merchant"
				 QUERY = "{ 'ALTER TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues CHANGE COLUMN rating_id review_id ' $ [ g.Module_Library_Native_DBAPI ].DB_Type_NUMBER( 0, 0 ) }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>

		<MvQUERY	NAME	= "Merchant"
					QUERY	= "{ 'CREATE INDEX ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues_1 ON ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues ( field_id, review_id )' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>

		<MvCOMMENT>
		|
		|	Rename sNN_TGReviews_Orders to sNN_TGReviewsOrders
		|	Update Indexes
		|
		</MvCOMMENT>
		
		<MvQUERY NAME = "Merchant"
				 QUERY = "{ 'RENAME TABLE ' $ g.Store_Table_Prefix $ 'TGReviews_Orders  TO ' $ g.Store_Table_Prefix $ 'TGReviewsOrders' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>

		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_Native_DBAPI ].DB_Drop_Index( g.Store_Table_Prefix $ 'TGReviewsOrders', g.Store_Table_Prefix $ 'TGReviews_Orders' ) }">

		<MvQUERY	NAME	= "Merchant"
					QUERY	= "{ 'CREATE UNIQUE INDEX ' $ g.Store_Table_Prefix $ 'TGReviewsOrders_1 ON ' $ g.Store_Table_Prefix $ 'TGReviewsOrders ( order_id )' }">
		<MvIF EXPR = "{ g.MvQUERY_Error }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
		</MvIF>
	</MvIF>
	
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Uninstall_Store" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvIF EXPR = "{ TGReviewsTemplates_Load( l.templates ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Delete_ManagedTemplate( l.templates:form_tmpl ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Delete_ManagedTemplate( l.templates:rvws_tmpl ) }">
		<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Delete_ManagedTemplate( l.templates:prlog_tmpl ) }">
	</MvIF>

	<MvIF EXPR = "{ [ g.Module_Feature_TUI_DB ].Page_Load_Code( 'TGR_Merchant_Email', l.merchant_email_page ) }">
		<MvASSIGN NAME = "l.success" VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Delete_Page( l.merchant_email_page ) }">
	</MvIF>

	<MvIF EXPR = "{ [ g.Module_Feature_TUI_DB ].Page_Load_Code( 'TGR_MailAfter_Email', l.mail_after_page ) }">
		<MvASSIGN NAME = "l.success" VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Delete_Page( l.mail_after_page ) }">
	</MvIF>

	<MvIF EXPR = "{ [ g.Module_Feature_TUI_DB ].Page_Load_Code( 'TGR_Customer_Email', l.customer_notification_page ) }">
		<MvASSIGN NAME = "l.success" VALUE = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_Delete_Page( l.customer_notification_page ) }">
	</MvIF>

	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsGeneralSettings' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsNotificationSettings' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsTemplates' }">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsProducts'}">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields'}">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues'}">
	<MvQUERY NAME = "Merchant" QUERY = "{ 'DROP TABLE ' $ g.Store_Table_Prefix $ 'TGReviewsOrders' }">

	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'TGRProduct' ) }">
	<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Delete( 'TGRAdditional' ) }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>


<MvCOMMENT>
| ====================================================================================
|	SYSTEM
| ====================================================================================
</MvCOMMENT>

<MvFUNCTION NAME = "SystemModule_Action" PARAMETERS = "module var, action" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "SystemModule_Screen" PARAMETERS = "module var, screen" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "SystemModule_UIException" PARAMETERS = "module var, exception" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
| ====================================================================================
|	VIS_SYSTEM
| ====================================================================================
</MvCOMMENT>

<MvFUNCTION NAME = "Module_System_Tabs" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "TGR_SETT:Product Reviews: Settings,TGR_SETT/FIELDS:Field Settings,TGR_SETT/REVIEW:Review Settings,TGR_SETT/RECAPTCHA:reCAPTCHA Settings,TGR_SETT/MAIL_AFTER:Mail After Notification,TGR_SETT/MERCHANT:Merchant Notification Email,TGR_SETT/CUSTOMER:Customer Notification Email,TGR_SETT/PRERENDER_LOGIC_TEMPLATE:Pre-Submission Logic Template,TGR_SETT/FORM_TEMPLATE:Review Form Template,TGR_SETT/REVIEWS_TEMPLATE:Reviews Template,TGR_SETT/FUNCTIONS:Item Functions,TGR_PROD:Product Reviews: Reviews,TGR_ADDL:Reviews: Additional Fields">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_System_Head" PARAMETERS = "module var, tab" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<MvIF EXPR = "{ l.tab EQ 'TGR_SETT' }">
		<style>
			.tgreviews_fields_table_container {
				width: 375px;
			}
		</style>
	</MvIF>

	<MvIF EXPR = "{ ( l.tab EQ 'TGR_PROD' ) }">
		<MvIF EXPR = "{ NOT TGReviewsGeneralSettings_Load_Cached( l.general_settings ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvEVAL EXPR = "{ [ g.Module_Admin ].Element_MMBatchList_JavaScript() }">
		<MvEVAL EXPR = "{ [ g.Module_Admin ].Element_MMBatchList_CSS() }">
		<MvEVAL EXPR = "{ [ g.Module_Admin ].Element_ProductLookup_Dialog_JavaScript() }">
		<MvEVAL EXPR = "{ [ g.Module_Admin ].Element_ProductLookup_Dialog_CSS() }">

		<script language="JavaScript" src="{ g.clientside_url $ 'Module_Code=' $ encodeattribute( l.module:code ) $ '&Filename=functions.js' }"></script>
		<script language="JavaScript" src="{ g.clientside_url $ 'Module_Code=' $ encodeattribute( l.module:code ) $ '&Filename=productlookupcolumn.js' }"></script>
		<script language="JavaScript" src="{ g.clientside_url $ 'Module_Code=' $ encodeattribute( l.module:code ) $ '&Filename=productreviewlist.js' }"></script>

		<MvEVAL EXPR = "{ [ g.Module_Admin ].JavaScript_Set_A_Variable_Boolean( 'TGReviewsGeneralSettings_auto_apprv', l.general_settings:auto_apprv ) }">

		<script language="JavaScript">
			MMScreen_LoadFinished( function() { new ProductReview_List( null, TGReviewsGeneralSettings_auto_apprv); } );
		</script>
	</MvIF>

	<MvIF EXPR = "{ ( l.tab EQ 'TGR_ADDL' ) }">
		<MvEVAL EXPR = "{ [ g.Module_Admin ].Element_MMBatchList_JavaScript() }">
		<MvEVAL EXPR = "{ [ g.Module_Admin ].Element_MMBatchList_CSS() }">

		<script language="JavaScript" src="{ g.clientside_url $ 'Module_Code=' $ encodeattribute( l.module:code ) $ '&Filename=functions.js' }"></script>
		<script language="JavaScript" src="{ g.clientside_url $ 'Module_Code=' $ encodeattribute( l.module:code ) $ '&Filename=additionalfieldlists.js' }"></script>

		<script language="JavaScript">
			MMScreen_LoadFinished( function() { new AdditionalField_List(); } );
		</script>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_System_Content" PARAMETERS = "module var, tab, load_fields" STANDARDOUTPUTLEVEL = "html, text, compresswhitespace">
	<MvIF EXPR = "{ ( l.tab EQ 'TGR_PROD' ) }">
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawButtons_Suppress( '[UPDATE]' ) }">
		<MvEVAL EXPR = "{ [ g.Module_Admin ].Element_MMBatchList_HTML() }">

		<div id="batchlist_productreviews"></div>
		<MvEVAL EXPR = "{ [ g.Module_Admin ].Element_ProductLookup_Dialog_HTML() }">
	</MvIF>

	<MvIF EXPR = "{ ( l.tab EQ 'TGR_ADDL' ) }">
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawButtons_Suppress( '[UPDATE]' ) }">
		<MvEVAL EXPR = "{ [ g.Module_Admin ].Element_MMBatchList_HTML() }">

		<div id="batchlist_additionalfields"></div>
	</MvIF>

	<MvIF EXPR = "{ l.tab EQ 'TGR_SETT' }">
		<MvIF EXPR = "{ l.load_fields }">
			<MvIF EXPR = "{ NOT TGReviewsGeneralSettings_Load( g.TGReviewsGeneralSettings ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
	
			<MvIF EXPR = "{ NOT TGReviewsNotificationSettings_Load( g.TGReviewsNotificationSettings ) }">
				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	</MvIF>
	
	<MvIF EXPR = "{ l.tab NE 'TGR_SETT' }">
		<MvHIDE FIELDS = "g.TGReviewsGeneralSettings, g.TGReviewsNotificationSettings">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvIF EXPR = "{ l.tab EQ 'TGR_SETT' }">
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_Start( 'TGR_SETT', 'FIELDS' ) }">
		<div class="mm9_table_container tgreviews_fields_table_container">
			<table border="0" cellpadding="0" cellspacing="0" width="100%" class="mm9_table">
				<thead>
					<tr>
						<td align="left" valign="middle" vnowrap>Field</td>
						<td align="center" valign="middle" nowrap>Required</td>
						<td align="center" valign="middle" nowrap>Optional</td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td align="left" valign="middle" vnowrap>
							Email
						</td>
						<td align="center" valign="middle" nowrap>
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawRadio( 'TGReviewsGeneralSettings:fld_email', 1, g.TGReviewsGeneralSettings:fld_email, '' ) }">
						</td>
						<td align="center" valign="middle" nowrap>
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawRadio( 'TGReviewsGeneralSettings:fld_email', 0, g.TGReviewsGeneralSettings:fld_email, '' ) }">
						</td>
					</tr>
					<tr>
						<td align="left" valign="middle" vnowrap>
							Location
						</td>
						<td align="center" valign="middle" nowrap>
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawRadio( 'TGReviewsGeneralSettings:fld_loc', 1, g.TGReviewsGeneralSettings:fld_loc, '' ) }">
						</td>
						<td align="center" valign="middle" nowrap>
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawRadio( 'TGReviewsGeneralSettings:fld_loc', 0, g.TGReviewsGeneralSettings:fld_loc, '' ) }">
						</td>
					</tr>
					<tr>
						<td align="left" valign="middle" vnowrap>
							Name
						</td>
						<td align="center" valign="middle" nowrap>
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawRadio( 'TGReviewsGeneralSettings:fld_name', 1, g.TGReviewsGeneralSettings:fld_name, '' ) }">
						</td>
						<td align="center" valign="middle" nowrap>
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawRadio( 'TGReviewsGeneralSettings:fld_name', 0, g.TGReviewsGeneralSettings:fld_name, '' ) }">
						</td>
					</tr>
					<tr>
						<td align="left" valign="middle" vnowrap>
							Summary
						</td>
						<td align="center" valign="middle" nowrap>
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawRadio( 'TGReviewsGeneralSettings:fld_summry', 1, g.TGReviewsGeneralSettings:fld_summry, '' ) }">
						</td>
						<td align="center" valign="middle" nowrap>
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawRadio( 'TGReviewsGeneralSettings:fld_summry', 0, g.TGReviewsGeneralSettings:fld_summry, '' ) }">
						</td>
					</tr>
					<tr>
						<td align="left" valign="middle" vnowrap>
							Title
						</td>
						<td align="center" valign="middle" nowrap>
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawRadio( 'TGReviewsGeneralSettings:fld_title', 1, g.TGReviewsGeneralSettings:fld_title, '' ) }">
						</td>
						<td align="center" valign="middle" nowrap>
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawRadio( 'TGReviewsGeneralSettings:fld_title', 0, g.TGReviewsGeneralSettings:fld_title, '' ) }">
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_End() }">
	
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_Start( 'TGR_SETT', 'REVIEW' ) }">
		<table border="0" cellpadding="2" cellspacing="0" width="100%">
			<tbody>
				<tr valign="top">
					<td nowrap><strong>Reviews Per Page:</strong></td>
					<td width="100%">
						<input type="text" name="TGReviewsGeneralSettings:per_page" size="20" value="{ encodeentities( g.TGReviewsGeneralSettings:per_page ) }">
					</td>
				</tr>
				<tr valign="top">
					<td nowrap><strong>Default Sorting Method:</strong></td>
					<td width="100%">
						<select name="TGReviewsGeneralSettings:sort">
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawOption( '-id',			g.TGReviewsGeneralSettings:sort, 'Default' ) }">
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawOption( '-created',	g.TGReviewsGeneralSettings:sort, 'Most Recent Reviews' ) }">
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawOption( 'created',		g.TGReviewsGeneralSettings:sort, 'Least Recent Reviews' ) }">
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawOption( '-rating',		g.TGReviewsGeneralSettings:sort, 'Highest To Lowest Rating' ) }">
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawOption( 'rating',		g.TGReviewsGeneralSettings:sort, 'Lowest to Highest Rating' ) }">
						</select>
					</td>
				</tr>
				<tr valign="top">
					<td colspan="2">
						<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawCheckbox_With_Label( g.TGReviewsGeneralSettings:auto_apprv, 'TGReviewsGeneralSettings:auto_apprv', 1, 'Auto Approve Reviews' ) }">
					</td>
				</tr>
			</tbody>
		</table>
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_End() }">
	
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_Start( 'TGR_SETT', 'RECAPTCHA' ) }">
		<table border="0" cellpadding="2" cellspacing="0" width="100%">
			<tbody>
				<tr valign="top">
					<td colspan="2">
						<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawCheckbox_With_Label( g.TGReviewsGeneralSettings:rc_enabled, 'TGReviewsGeneralSettings:rc_enabled', 1, 'reCAPTCHA Enabled' ) }">
					</td>
				</tr>
				<tr valign="top">
					<td nowrap><strong>Public Key:</strong></td>
					<td width="100%">
						<input type="text" name="TGReviewsGeneralSettings:rc_pub_key" size="50" value="{ encodeentities( g.TGReviewsGeneralSettings:rc_pub_key ) }">
					</td>
				</tr>
				<tr valign="top">
					<td nowrap><strong>Private Key:</strong></td>
					<td width="100%">
						<input type="password" name="TGReviewsGeneralSettings:rc_prv_key" size="50" value="">
					</td>
				</tr>
				<tr valign="top">
					<td nowrap><strong>Confirm Private Key:</strong></td>
					<td width="100%">
						<input type="password" name="TGReviewsGeneralSettings:rc_prv_key_confirm" size="50" value="">
					</td>
				</tr>
			</tbody>
		</table>
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_End() }">

		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_Start( 'TGR_SETT', 'MAIL_AFTER' ) }">
		<div class="mm9_table_container tgreviews_fields_table_container">
			<table border="0" cellpadding="0" cellspacing="0" width="100%" class="mm9_table">
				<thead>
					<tr>
						<td colspan="2">
							Page Template Used: <strong>TGR_MailAfter_Email</strong>
						</td>
					</tr>
				</thead>
				<tbody>
					<tr valign="top">
						<td colspan="2">
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawCheckbox_With_Label( g.TGReviewsNotificationSettings:ma_enable, 'TGReviewsNotificationSettings:ma_enable', 1, 'Notification Enabled' ) }">
						</td>
					</tr>
					<tr valign="top">
						<td nowrap><strong>Send After:</strong></td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:ma_days" value="{ encodeentities( g.TGReviewsNotificationSettings:ma_days ) }"> day(s)
						</td>
					</tr>
					<tr valign="top">
						<td nowrap><strong>After:</strong></td>
						<td width="100%">
							<select name="TGReviewsNotificationSettings:ma_after">
								<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawOption( 'order',	g.TGReviewsNotificationSettings:ma_after, 'Order Date' ) }">
								<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawOption( 'ship',	g.TGReviewsNotificationSettings:ma_after, 'Shipment Date' ) }">
							</select>
						</td>
					</tr>
					<tr valign="top">
						<td nowrap><strong>From:</strong></td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:ma_from" value="{ encodeentities( g.TGReviewsNotificationSettings:ma_from ) }">
						</td>
					</tr>
					<tr valign="top">
						<td nowrap>CC:</td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:ma_cc" value="{ encodeentities( g.TGReviewsNotificationSettings:ma_cc ) }">
						</td>
					</tr>
					<tr valign="top">
						<td nowrap>BCC:</td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:ma_bcc" value="{ encodeentities( g.TGReviewsNotificationSettings:ma_bcc ) }">
						</td>
					</tr>
					<tr valign="top">
						<td nowrap><strong>Subject:</strong></td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:ma_subject" value="{ encodeentities( g.TGReviewsNotificationSettings:ma_subject ) }">
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_End() }">

		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_Start( 'TGR_SETT', 'MERCHANT' ) }">
		<div class="mm9_table_container tgreviews_fields_table_container">
			<table border="0" cellpadding="0" cellspacing="0" width="100%" class="mm9_table">
				<thead>
					<tr>
						<td colspan="2">
							Page Template Used: <strong>TGR_Merchant_Email</strong>
						</td>
					</tr>
				</thead>
				<tbody>
					<tr valign="top">
						<td colspan="2">
							<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawCheckbox_With_Label( g.TGReviewsNotificationSettings:mn_enable, 'TGReviewsNotificationSettings:mn_enable', 1, 'Notification Enabled' ) }">
						</td>
					</tr>
					<tr valign="top">
						<td nowrap><strong>To:</strong></td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:mn_to" value="{ encodeentities( g.TGReviewsNotificationSettings:mn_to ) }">
						</td>
					</tr>
					<tr valign="top">
						<td nowrap><strong>From:</strong></td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:mn_from" value="{ encodeentities( g.TGReviewsNotificationSettings:mn_from ) }">
						</td>
					</tr>
					<tr valign="top">
						<td nowrap>CC:</td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:mn_cc" value="{ encodeentities( g.TGReviewsNotificationSettings:mn_cc ) }">
						</td>
					</tr>
					<tr valign="top">
						<td nowrap>BCC:</td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:mn_bcc" value="{ encodeentities( g.TGReviewsNotificationSettings:mn_bcc ) }">
						</td>
					</tr>
					<tr valign="top">
						<td nowrap><strong>Subject:</strong></td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:mn_subject" value="{ encodeentities( g.TGReviewsNotificationSettings:mn_subject ) }">
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_End() }">

		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_Start( 'TGR_SETT', 'CUSTOMER' ) }">
		<div class="mm9_table_container tgreviews_fields_table_container">
			<table border="0" cellpadding="0" cellspacing="0" width="100%" class="mm9_table">
				<thead>
					<tr>
						<td colspan="2">
							Page Template Used: <strong>TGR_Customer_Email</strong>
						</td>
					</tr>
				</thead>
				<tbody>
					<tr valign="top">
						<td nowrap><strong>From:</strong></td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:cn_from" value="{ encodeentities( g.TGReviewsNotificationSettings:cn_from ) }">
						</td>
					</tr>
					<tr valign="top">
						<td nowrap>CC:</td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:cn_cc" value="{ encodeentities( g.TGReviewsNotificationSettings:cn_cc ) }">
						</td>
					</tr>
					<tr valign="top">
						<td nowrap>BCC:</td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:cn_bcc" value="{ encodeentities( g.TGReviewsNotificationSettings:cn_bcc ) }">
						</td>
					</tr>
					<tr valign="top">
						<td nowrap><strong>Subject:</strong></td>
						<td width="100%">
							<input type="text" name="TGReviewsNotificationSettings:cn_subject" value="{ encodeentities( g.TGReviewsNotificationSettings:cn_subject ) }">
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_End() }">

		<MvIF EXPR = "{ NOT TGReviewsTemplates_Load_Cached( l.templates ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_Start( 'TGR_SETT', 'PRERENDER_LOGIC_TEMPLATE' ) }">
		<table border="0" cellpadding="2" cellspacing="0" width="100%">
			<tr>
				<td align="left" nowrap valign="top" colspan="2">
					On form submission (front-end submissions only), you can add extra validation before the review is submitted.<br>
					You can set <code>l.settings:review_submission</code> to 0, and it will prevent the review from being submitted.<br>
					You will need to handle the error messaging, and highlighting of fields via the Template Code.
					<br><br>
				</td>
			</tr>
			<MvEVAL EXPR = "{ Admin_Template( 'Pre-Render Logic', 'TGReviewsTemplates:prlog_tmpl_', l.templates:prlog_tmpl, l.load_fields ) }">
		</table>
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_End() }">

		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_Start( 'TGR_SETT', 'FORM_TEMPLATE' ) }">
		<table border="0" cellpadding="2" cellspacing="0" width="100%">
			<tr>
				<td align="left" nowrap valign="top" colspan="2">
					<MvEVAL EXPR = "{ Admin_Formatted_Item_Function( 'Form', '' ) }">
					<br><br>
				</td>
			</tr>
			<MvEVAL EXPR = "{ Admin_Template( 'Form', 'TGReviewsTemplates:form_tmpl_', l.templates:form_tmpl , l.load_fields ) }">
		</table>
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_End() }">
		
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_Start( 'TGR_SETT', 'REVIEWS_TEMPLATE' ) }">
		<table border="0" cellpadding="2" cellspacing="0" width="100%">
			<tr>
				<td align="left" nowrap valign="top" colspan="2">
					<MvEVAL EXPR = "{ Admin_Formatted_Item_Function( 'Reviews_Template', ' l.settings:product:id ' ) }">
					<br><br>
				</td>
			</tr>
			<MvEVAL EXPR = "{ Admin_Template( 'Reviews', 'TGReviewsTemplates:rvws_tmpl_', l.templates:rvws_tmpl , l.load_fields ) }">
		</table>
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_End() }">

		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_Start( 'TGR_SETT', 'FUNCTIONS' ) }">
		<div class="mm9_table_container">
			<table class="mm9_table">
				<thead>
					<tr>
						<td align="left" valign="middle">Function</td>
						<td align="left" valign="middle">Information</td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td><MvEVAL EXPR = "{ Admin_Formatted_Item_Function( 'Form_Template', '') }"></td>
						<td>Render the Form Template.</td>
					</tr>
					<tr>
						<td><MvEVAL EXPR = "{ Admin_Formatted_Item_Function( 'Reviews_Template', ' l.settings:product:id ') }"></td>
						<td>Render the Reviews Template. Returns <pre style="display:inline;">reviews array</pre> in <pre style="display:inline;">l.settings:tgr:reviews</pre>. If you do not pass an id (i.e. put 0, or an empty string), it will return all approved reviews for the store.</td>
					</tr>
					<tr>
						<td><MvEVAL EXPR = "{ Admin_Formatted_Item_Function( 'Load_Product_Reviews', ' l.settings:product:id, l.settings:product:reviews ') }"></td>
						<td>Use this to save all the review data to a variable and utilize in template code.</td>
					</tr>
					<tr>
						<td><MvEVAL EXPR = "{ Admin_Formatted_Item_Function( 'Date', ' \'F jS, Y\', l.settings:review:created, l.settings:review:formatted_created ') }"></td>
						<td>Format a timestamp, and save to a variable (3rd parameter). Uses PHP's date function as a reference.</td>
					</tr>
					<tr>
						<td><MvEVAL EXPR = "{ Admin_Formatted_Item_Function( 'Product_Rating', ' l.settings:product:id, l.settings:product:product_rating ') }"></td>
						<td>Returns the average product rating value to a variable (2nd parameter).</td>
					</tr>
					<tr>
						<td><MvEVAL EXPR = "{ Admin_Formatted_Item_Function( 'Product_Review_Breakdowns', ' l.settings:product:id, l.settings:tgr:breakdown ') }"></td>
						<td>Returns a breakdown of ratings for a product to a variable (2nd parameter). Array has 2 members: <pre style="display:inline;">count</pre> and <pre style="display:inline;">rating</pre></td>
					</tr>
					<tr>
						<td><MvEVAL EXPR = "{ Admin_Formatted_Item_Function( 'Product_Review_Count', ' l.settings:product:id, l.settings:tgr:review_count ') }"></td>
						<td>Returns a total number of approved reviews for a product to a variable (2nd parameter).</td>
					</tr>
					<tr>
						<td><MvEVAL EXPR = "{ Admin_Formatted_Item_Function( 'Test_MailAfter_Email', ' 12345, \'hello@email.com\' ') }"></td>
						<td>This will trigger the email for any order you specify, to the email you specify. This is specifically made to test the email template. Please note: BCC and CC will not carry through. If you have left a review on a product in the order, it will skip that product.</td>
					</tr>
					<tr>
						<td><MvEVAL EXPR = "{ Admin_Formatted_Item_Function( 'Customer_Product_Reviews', ' g.Basket:cust_id, l.settings:customer:reviews ') }"></td>
						<td>Load all reviews written by a customer (cust_id). This will load all approved, and non approved reviews.</td>
					</tr>
					<tr>
						<td><MvEVAL EXPR = "{ Admin_Formatted_Item_Function( 'Customer_Product_Reviews_Product', ' g.Basket:cust_id, l.settings:product:id, l.settings:customer:reviews ') }"></td>
						<td>Load all reviews written by a customer (cust_id) for a specific product (product_id). This will load all approved, and non approved reviews.</td>
					</tr>
				</tbody>
			</table>
		</div>
		<MvEVAL EXPR = "{ [ g.Module_Admin ].DrawGroupTabEntry_End() }">
	
	
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_System_Update" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT TGReviewsGeneralSettings_Load_Cached( l.general_settings ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "l.general_settings:fld_name"		VALUE = "{ g.TGReviewsGeneralSettings:fld_name }">
	<MvASSIGN NAME = "l.general_settings:fld_email"		VALUE = "{ g.TGReviewsGeneralSettings:fld_email }">
	<MvASSIGN NAME = "l.general_settings:fld_loc"		VALUE = "{ g.TGReviewsGeneralSettings:fld_loc }">
	<MvASSIGN NAME = "l.general_settings:fld_summry"	VALUE = "{ g.TGReviewsGeneralSettings:fld_summry }">
	<MvASSIGN NAME = "l.general_settings:fld_title"		VALUE = "{ g.TGReviewsGeneralSettings:fld_title }">
	<MvASSIGN NAME = "l.general_settings:per_page"		VALUE = "{ g.TGReviewsGeneralSettings:per_page }">
	<MvASSIGN NAME = "l.general_settings:sort"			VALUE = "{ g.TGReviewsGeneralSettings:sort }">
	<MvASSIGN NAME = "l.general_settings:auto_apprv"	VALUE = "{ g.TGReviewsGeneralSettings:auto_apprv }">
	<MvASSIGN NAME = "l.general_settings:rc_enabled"	VALUE = "{ g.TGReviewsGeneralSettings:rc_enabled }">
	<MvASSIGN NAME = "l.general_settings:rc_pub_key"	VALUE = "{ g.TGReviewsGeneralSettings:rc_pub_key }">

	<MvIF EXPR = "{ NOT ISNULL g.TGReviewsGeneralSettings:rc_prv_key }">
		<MvASSIGN NAME = "l.general_settings:rc_prv_key"	VALUE = "{ g.TGReviewsGeneralSettings:rc_prv_key }">
	</MvIF>

	<MvASSIGN NAME = "l.notification_settings:ma_enable"	VALUE = "{ g.TGReviewsNotificationSettings:ma_enable }">
	<MvASSIGN NAME = "l.notification_settings:ma_days"		VALUE = "{ g.TGReviewsNotificationSettings:ma_days }">
	<MvASSIGN NAME = "l.notification_settings:ma_after"		VALUE = "{ g.TGReviewsNotificationSettings:ma_after }">
	<MvASSIGN NAME = "l.notification_settings:ma_from"		VALUE = "{ g.TGReviewsNotificationSettings:ma_from }">
	<MvASSIGN NAME = "l.notification_settings:ma_cc"		VALUE = "{ g.TGReviewsNotificationSettings:ma_cc }">
	<MvASSIGN NAME = "l.notification_settings:ma_bcc"		VALUE = "{ g.TGReviewsNotificationSettings:ma_bcc }">
	<MvASSIGN NAME = "l.notification_settings:ma_subject"	VALUE = "{ g.TGReviewsNotificationSettings:ma_subject }">
	<MvASSIGN NAME = "l.notification_settings:mn_enable"	VALUE = "{ g.TGReviewsNotificationSettings:mn_enable }">
	<MvASSIGN NAME = "l.notification_settings:mn_to"		VALUE = "{ g.TGReviewsNotificationSettings:mn_to }">
	<MvASSIGN NAME = "l.notification_settings:mn_from"		VALUE = "{ g.TGReviewsNotificationSettings:mn_from }">
	<MvASSIGN NAME = "l.notification_settings:mn_cc"		VALUE = "{ g.TGReviewsNotificationSettings:mn_cc }">
	<MvASSIGN NAME = "l.notification_settings:mn_bcc"		VALUE = "{ g.TGReviewsNotificationSettings:mn_bcc }">
	<MvASSIGN NAME = "l.notification_settings:mn_subject"	VALUE = "{ g.TGReviewsNotificationSettings:mn_subject }">
	<MvASSIGN NAME = "l.notification_settings:cn_from"		VALUE = "{ g.TGReviewsNotificationSettings:cn_from }">
	<MvASSIGN NAME = "l.notification_settings:cn_cc"		VALUE = "{ g.TGReviewsNotificationSettings:cn_cc }">
	<MvASSIGN NAME = "l.notification_settings:cn_bcc"		VALUE = "{ g.TGReviewsNotificationSettings:cn_bcc }">
	<MvASSIGN NAME = "l.notification_settings:cn_subject"	VALUE = "{ g.TGReviewsNotificationSettings:cn_subject }">

	<MvIF EXPR = "{ NOT TGReviewsGeneralSettings_Update( l.general_settings ) OR
					NOT TGReviewsNotificationSettings_Update( l.notification_settings ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ g.Tab EQ 'TGR_SETT' }">
		<MvIF EXPR = "{ NOT TGReviewsTemplates_Load_Cached( l.templates ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvIF EXPR = "{ NOT Admin_Template_Update( l.module, 'Pre-Render Logic', 'TGReviewsTemplates:prlog_tmpl_', l.templates:prlog_tmpl )	OR
						NOT Admin_Template_Update( l.module, 'Form', 'TGReviewsTemplates:form_tmpl_', l.templates:form_tmpl )				OR
						NOT Admin_Template_Update( l.module, 'Reviews', 'TGReviewsTemplates:rvws_tmpl_', l.templates:rvws_tmpl ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_System_Validate" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ NOT TGReviewsGeneralSettings_Load_Cached( l.general_settings ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:fld_name"				VALUE = "{ [ g.Module_Admin ].Trim_Boolean( g.TGReviewsGeneralSettings:fld_name ) }">
	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:fld_email"				VALUE = "{ [ g.Module_Admin ].Trim_Boolean( g.TGReviewsGeneralSettings:fld_email ) }">
	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:fld_loc" 				VALUE = "{ [ g.Module_Admin ].Trim_Boolean( g.TGReviewsGeneralSettings:fld_loc ) }">
	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:fld_summry"			VALUE = "{ [ g.Module_Admin ].Trim_Boolean( g.TGReviewsGeneralSettings:fld_summry ) }">
	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:fld_title"				VALUE = "{ [ g.Module_Admin ].Trim_Boolean( g.TGReviewsGeneralSettings:fld_title ) }">
	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:fld_title"				VALUE = "{ [ g.Module_Admin ].Trim_Boolean( g.TGReviewsGeneralSettings:fld_title ) }">
	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:auto_apprv"			VALUE = "{ [ g.Module_Admin ].Trim_Boolean( g.TGReviewsGeneralSettings:auto_apprv ) }">
	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:per_page"				VALUE = "{ trim( g.TGReviewsGeneralSettings:per_page ) }">
	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:sort"					VALUE = "{ trim( g.TGReviewsGeneralSettings:sort ) }">
	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:rc_enabled"			VALUE = "{ [ g.Module_Admin ].Trim_Boolean( g.TGReviewsGeneralSettings:rc_enabled ) }">
	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:rc_pub_key"			VALUE = "{ trim( g.TGReviewsGeneralSettings:rc_pub_key ) }">
	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:rc_prv_key"			VALUE = "{ trim( g.TGReviewsGeneralSettings:rc_prv_key ) }">
	<MvASSIGN NAME = "g.TGReviewsGeneralSettings:rc_prv_key_confirm"	VALUE = "{ trim( g.TGReviewsGeneralSettings:rc_prv_key_confirm ) }">

	<MvIF EXPR = "{ g.TGReviewsGeneralSettings:rc_enabled AND ISNULL l.general_settings:rc_prv_key }">	<MvASSIGN NAME = "l.private_key_required" VALUE = 1>
	<MvELSE>																							<MvASSIGN NAME = "l.private_key_required" VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_WholeNumber_Positive_Required( g.TGReviewsGeneralSettings:per_page ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsGeneralSettings:per_page', g.Validation_Message ) }">
	</MvIF>

	<MvIF EXPR = "{ ( g.TGReviewsGeneralSettings:sort NE '-id' )		AND
					( g.TGReviewsGeneralSettings:sort NE '-created' )	AND
					( g.TGReviewsGeneralSettings:sort NE 'created' )	AND
					( g.TGReviewsGeneralSettings:sort NE '-rating' )	AND
					( g.TGReviewsGeneralSettings:sort NE 'rating' ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsGeneralSettings:sort', 'Please select a value for the default sorting method' ) }">
	</MvIF>

	<MvIF EXPR = "{ g.TGReviewsGeneralSettings:rc_enabled AND ISNULL g.TGReviewsGeneralSettings:rc_pub_key }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsGeneralSettings:rc_pub_key', 'Public key cannot be blank' ) }">
	</MvIF>

	<MvIF EXPR = "{ l.private_key_required }">
		<MvIF EXPR = "{ ISNULL g.TGReviewsGeneralSettings:rc_prv_key }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsGeneralSettings:rc_prv_key', 'Private key cannot be blank' ) }">
		<MvELSEIF EXPR = "{ g.TGReviewsGeneralSettings:rc_prv_key NE g.TGReviewsGeneralSettings:rc_prv_key_confirm }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsGeneralSettings:rc_prv_key', 'Private keys do not match' ) }">
		</MvIF>
	</MvIF>

	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:ma_enable"	VALUE = "{ [ g.Module_Admin ].Trim_Boolean( g.TGReviewsNotificationSettings:ma_enable ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:ma_days"		VALUE = "{ trim( g.TGReviewsNotificationSettings:ma_days ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:ma_after"		VALUE = "{ trim( g.TGReviewsNotificationSettings:ma_after ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:ma_from"		VALUE = "{ trim( g.TGReviewsNotificationSettings:ma_from ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:ma_cc"		VALUE = "{ trim( g.TGReviewsNotificationSettings:ma_cc ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:ma_bcc"		VALUE = "{ trim( g.TGReviewsNotificationSettings:ma_bcc ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:ma_subject"	VALUE = "{ trim( g.TGReviewsNotificationSettings:ma_subject ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:mn_enable"	VALUE = "{ [ g.Module_Admin ].Trim_Boolean( g.TGReviewsNotificationSettings:mn_enable ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:mn_to"		VALUE = "{ trim( g.TGReviewsNotificationSettings:mn_to ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:mn_from"		VALUE = "{ trim( g.TGReviewsNotificationSettings:mn_from ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:mn_cc"		VALUE = "{ trim( g.TGReviewsNotificationSettings:mn_cc ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:mn_bcc"		VALUE = "{ trim( g.TGReviewsNotificationSettings:mn_bcc ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:mn_subject"	VALUE = "{ trim( g.TGReviewsNotificationSettings:mn_subject ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:cn_from"		VALUE = "{ trim( g.TGReviewsNotificationSettings:cn_from ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:cn_cc"		VALUE = "{ trim( g.TGReviewsNotificationSettings:cn_cc ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:cn_bcc"		VALUE = "{ trim( g.TGReviewsNotificationSettings:cn_bcc ) }">
	<MvASSIGN NAME = "g.TGReviewsNotificationSettings:cn_subject"	VALUE = "{ trim( g.TGReviewsNotificationSettings:cn_subject ) }">

	<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_Email( g.TGReviewsNotificationSettings:ma_from ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:ma_from', g.Validation_Message ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT ISNULL g.TGReviewsNotificationSettings:ma_cc }">
		<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_Email( g.TGReviewsNotificationSettings:ma_cc ) }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:ma_cc', g.Validation_Message ) }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT ISNULL g.TGReviewsNotificationSettings:ma_bcc }">
		<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_Email( g.TGReviewsNotificationSettings:ma_bcc ) }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:ma_bcc', g.Validation_Message ) }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ ISNULL g.TGReviewsNotificationSettings:ma_subject }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:ma_subject', 'Please enter a value for Subject' ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_WholeNumber_Positive_Required( g.TGReviewsNotificationSettings:ma_days ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:ma_days', g.Validation_Message ) }">
	</MvIF>

	<MvIF EXPR = "{ ( g.TGReviewsNotificationSettings:ma_after NE 'order' ) AND
					( g.TGReviewsNotificationSettings:ma_after NE 'ship' )}">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:ma_after', 'Please select a value for after' ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_Email( g.TGReviewsNotificationSettings:mn_to ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:mn_to', g.Validation_Message ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_Email( g.TGReviewsNotificationSettings:mn_from ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:mn_from', g.Validation_Message ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT ISNULL g.TGReviewsNotificationSettings:mn_cc }">
		<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_Email( g.TGReviewsNotificationSettings:mn_cc ) }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:mn_cc', g.Validation_Message ) }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT ISNULL g.TGReviewsNotificationSettings:mn_bcc }">
		<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_Email( g.TGReviewsNotificationSettings:mn_bcc ) }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:mn_bcc', g.Validation_Message ) }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ ISNULL g.TGReviewsNotificationSettings:mn_subject }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:mn_subject', 'Please enter a value for Subject' ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_Email( g.TGReviewsNotificationSettings:cn_from ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:cn_from', g.Validation_Message ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT ISNULL g.TGReviewsNotificationSettings:cn_cc }">
		<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_Email( g.TGReviewsNotificationSettings:cn_cc ) }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:cn_cc', g.Validation_Message ) }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT ISNULL g.TGReviewsNotificationSettings:cn_bcc }">
		<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_Email( g.TGReviewsNotificationSettings:cn_bcc ) }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:cn_bcc', g.Validation_Message ) }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ ISNULL g.TGReviewsNotificationSettings:cn_subject }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', 'TGReviewsNotificationSettings:cn_subject', 'Please enter a value for Subject' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
|	json
|
</MvCOMMENT>

<MvFUNCTION NAME = "Module_JSON" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Module_Function EQ 'Product_Reviews_Load_Query' }">		<MvFUNCTIONRETURN VALUE = "{ JSON_Product_Reviews_Load_Query( l.module ) }">
	<MvCOMMENT> <MvELSEIF EXPR = "{ g.Module_Function EQ 'Product_Review_Update' }">		<MvFUNCTIONRETURN VALUE = "{ JSON_Product_Review_Update( l.module ) }"> </MvCOMMENT>
	<MvELSEIF EXPR = "{ g.Module_Function EQ 'Product_Review_Insert' }">		<MvFUNCTIONRETURN VALUE = "{ JSON_Product_Review_Insert( l.module ) }">
	<MvCOMMENT> <MvELSEIF EXPR = "{ g.Module_Function EQ 'Product_Review_Delete' }">		<MvFUNCTIONRETURN VALUE = "{ JSON_Product_Review_Delete( l.module ) }"> </MvCOMMENT>
	<MvELSEIF EXPR = "{ g.Module_Function EQ 'Load_All_AdditionalFields' }">	<MvFUNCTIONRETURN VALUE = "{ JSON_Load_All_AdditionalFields( l.module ) }">
	<MvCOMMENT> <MvELSEIF EXPR = "{ g.Module_Function EQ 'AdditionalFields_Load_Query' }">	<MvFUNCTIONRETURN VALUE = "{ JSON_AdditionalFields_Load_Query( l.module ) }">
	<MvELSEIF EXPR = "{ g.Module_Function EQ 'AdditionalField_Update' }">		<MvFUNCTIONRETURN VALUE = "{ JSON_AdditionalField_Update( l.module ) }">
	<MvELSEIF EXPR = "{ g.Module_Function EQ 'AdditionalField_Insert' }">		<MvFUNCTIONRETURN VALUE = "{ JSON_AdditionalField_Insert( l.module ) }">
	<MvELSEIF EXPR = "{ g.Module_Function EQ 'AdditionalField_Delete' }">		<MvFUNCTIONRETURN VALUE = "{ JSON_AdditionalField_Delete( l.module ) }"> </MvCOMMENT>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "JSON_TGReviewsProduct" PARAMETERS = "review var" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	"id":			<MvEVAL EXPR = "{ int( l.review:id ) }">,
	"created":		<MvEVAL EXPR = "{ int( l.review:created ) }">,
	"product_id":	<MvEVAL EXPR = "{ int( l.review:product_id ) }">,
	"cust_id":		<MvEVAL EXPR = "{ int( l.review:cust_id ) }">,
	"order_id":		<MvEVAL EXPR = "{ int( l.review:order_id ) }">,
	"approved":		<MvEVAL EXPR = "{ int( l.review:approved ) }">,
	"rating":		<MvEVAL EXPR = "{ int( l.review:rating ) }">,
	"name":			"<MvEVAL EXPR = "{ [ g.Module_JSON ].JSON_Encode( l.review:name ) }">",
	"email":		"<MvEVAL EXPR = "{ [ g.Module_JSON ].JSON_Encode( l.review:email ) }">",
	"location":		"<MvEVAL EXPR = "{ [ g.Module_JSON ].JSON_Encode( l.review:location ) }">",
	"notify":		<MvEVAL EXPR = "{ int( l.review:notify ) }">,
	"title":		"<MvEVAL EXPR = "{ [ g.Module_JSON ].JSON_Encode( l.review:title ) }">",
	"summary":		"<MvEVAL EXPR = "{ [ g.Module_JSON ].JSON_Encode( l.review:summary ) }">",
	"store_rply":	"<MvEVAL EXPR = "{ [ g.Module_JSON ].JSON_Encode( l.review:store_rply ) }">",
	"notified":		<MvEVAL EXPR = "{ int( l.review:notified ) }">,
	"verified":		<MvEVAL EXPR = "{ int( l.review:verified ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JSON_Product_Reviews_Load_Query" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Session_Type NE 'admin' }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_Access_Denied() }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ JSON_Product_Reviews_Load_Query_LowLevel( l.module ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "JSON_Product_Reviews_Load_Query_LowLevel" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<MvIF EXPR = "{ NOT [ g.Module_JSON ].JSON_Store_Open() }">				<MvFUNCTIONRETURN>																	</MvIF>
	<MvIF EXPR = "{ NOT [ g.Module_Admin ].CanI( 'SYSM', 1, 0, 0, 0 ) }">	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_Access_Denied() }">	</MvIF>

	<MvASSIGN NAME = "l.filter"			VALUE = "">
	<MvASSIGN NAME = "l.sort"			VALUE = "">
	<MvASSIGN NAME = "l.offset"			VALUE = 0>
	<MvASSIGN NAME = "l.count"			VALUE = 0>

	<MvIF EXPR = "{ NOT [ g.Module_JSON ].JSON_Input_Filter(	'o', 'Filter',	l.filter )				OR
					NOT [ g.Module_JSON ].JSON_Input_Text(		'o', 'Sort',	l.sort )				OR
					NOT [ g.Module_JSON ].JSON_Input_Number(	'o', 'Offset',	l.offset,	-1, -1 )	OR
					NOT [ g.Module_JSON ].JSON_Input_Number(	'o', 'Count',	l.count,	-1, -1 ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_InputErrors() }">
	</MvIF>

	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_SELECT( l.search_query, 'tgrp.*,
																				 p.code AS product_code,
																				 p.name AS product_name' ) }">

	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_FROM( l.search_query, g.Store_Table_Prefix $ 'TGReviewsProducts', 'tgrp' ) }">

	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_LEFT_OUTER_JOIN( l.search_query, 'tgrp', g.Store_Table_Prefix $ 'Products', 'p', 'tgrp.product_id = p.id', '' ) }">

	<MvEVAL EXPR = "{ [ g.Module_JSON ].JSON_Filter( l.search_query, l.filter,
		'id:tgrp.id,created:tgrp.created,product_id:tgrp.product_id,cust_id:tgrp.cust_id,order_id:tgrp.order_id,approved:tgrp.approved,rating:tgrp.rating,name:tgrp.name,email:tgrp.email,location:tgrp.location,notify:tgrp.notify,title:tgrp.title,summary:tgrp.summary,store_reply:tgrp.store_rply,notified:tgrp.notified,verified:tgrp.verified,product_name:p.name,product_code:p.code' ) }">

	<MvEVAL EXPR = "{ [ g.Module_Library_DB ].SQL_Query_OrderBy_Fields( l.search_query, l.sort,
		'id:tgrp.id,created:tgrp.created,product_id:tgrp.product_id,cust_id:tgrp.cust_id,order_id:tgrp.order_id,approved:tgrp.approved,rating:tgrp.rating,name:tgrp.name,email:tgrp.email,location:tgrp.location,notify:tgrp.notify,title:tgrp.title,summary:tgrp.summary,store_reply:tgrp.store_rply,notified:tgrp.notified,verified:tgrp.verified,product_name:p.name,product_code:p.code',
		'tgrp.id' ) }">
		
	<MvASSIGN NAME = "l.search_sql" VALUE = "{ [ g.Module_Library_DB ].SQL_Query_Build( l.search_query, l.search_fields ) }">

	<MvIF EXPR = "{ NOT [ g.Module_Library_DB ].SQL_Query_Count( l.search_query, l.total_count ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_Error( g.Error_Code, g.Error_Message ) }">
	<MvELSEIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_OPENVIEW_Range( 'Merchant', 'TGReviewsProducts', l.search_sql, l.search_fields, l.offset, l.count ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_Error( '#Error#', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvASSIGN NAME = "l.review_count" VALUE = 0>

	<MvEVAL EXPR = "{ [ g.Module_JSON ].JSON_Response_Start() }">
	{
		"total_count":	<MvEVAL EXPR = "{ int( l.total_count ) }">,
		"start_offset":	<MvEVAL EXPR = "{ int( l.offset ) }">,
		"data":
		[
		<MvWHILE EXPR = "{ ( NOT TGReviewsProducts.d.EOF ) AND ( ( l.count EQ 0 ) OR ( l.review_count LT l.count ) ) }">
			<MvEVAL EXPR = "{ TGReviewsProduct_Read( l.point ) }">

			<MvEVAL EXPR = "{ [ g.Module_JSON ].JSON_ArrayElement_Start( l.review_count ) }">
				<MvEVAL EXPR = "{ JSON_TGReviewsProduct( l.point ) }">,
				"product_code": "<MvEVAL EXPR = "{ [ g.Module_JSON ].JSON_Encode( TGReviewsProducts.d.product_code ) }">",
				"product_name": "<MvEVAL EXPR = "{ [ g.Module_JSON ].JSON_Encode( TGReviewsProducts.d.product_name ) }">"
			<MvEVAL EXPR = "{ [ g.Module_JSON ].JSON_ArrayElement_End() }">

			<MvSKIP NAME = "Merchant" VIEW = "TGReviewsProducts" ROWS = 1>
		</MvWHILE>
		]
	}
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviewsProducts">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_End() }">
</MvFUNCTION>

<MvFUNCTION NAME = "JSON_Product_Review_Insert" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ g.Session_Type NE 'admin' }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_Access_Denied() }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = "{ JSON_Product_Review_Insert_LowLevel( l.module ) }">
</MvFUNCTION>


<MvFUNCTION NAME = "JSON_Product_Review_Insert_LowLevel" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<MvIF EXPR = "{ NOT [ g.Module_JSON ].JSON_Store_Open() }">				<MvFUNCTIONRETURN>																	</MvIF>
	<MvIF EXPR = "{ NOT [ g.Module_Admin ].CanI( 'SYSM', 0, 1, 0, 0 ) }">	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_Access_Denied() }">	</MvIF>

	<MvIF EXPR = "{ NOT TGReviewsGeneralSettings_Load_Cached( l.general_settings ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_Error( g.Error_Code, g.Error_Message ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_JSON ].JSON_Product_Load( l.product ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_FieldError( 'Product_Code', 'Please select a valid Product Code.' ) }">
	</MvIF>

	<MvIF EXPR = "{ [ g.Module_Feature_CUS_JSON ].JSON_Customer_Load( l.customer ) }">
		<MvASSIGN NAME = "l.review:cust_id" VALUE = "{ l.customer:id }">
	</MvIF>

	<MvASSIGN NAME = "l.review:product_id" VALUE = "{ l.product:id }">

	<MvASSIGN NAME = "l.fld_name"	VALUE = "o">
	<MvASSIGN NAME = "l.fld_email"	VALUE = "o">
	<MvASSIGN NAME = "l.fld_loc"	VALUE = "o">
	<MvASSIGN NAME = "l.fld_summry"	VALUE = "o">
	<MvASSIGN NAME = "l.fld_title"	VALUE = "o">

	<MvIF EXPR = "{ l.general_settings:fld_name }">		<MvASSIGN NAME = "l.fld_name"	VALUE = "R"> </MvIF>
	<MvIF EXPR = "{ l.general_settings:fld_email }">	<MvASSIGN NAME = "l.fld_email"	VALUE = "R"> </MvIF>
	<MvIF EXPR = "{ l.general_settings:fld_loc }">		<MvASSIGN NAME = "l.fld_loc"	VALUE = "R"> </MvIF>
	<MvIF EXPR = "{ l.general_settings:fld_summry }">	<MvASSIGN NAME = "l.fld_summry"	VALUE = "R"> </MvIF>
	<MvIF EXPR = "{ l.general_settings:fld_title }">	<MvASSIGN NAME = "l.fld_title"	VALUE = "R"> </MvIF>

	<MvIF EXPR = "{ NOT [ g.Module_JSON ].JSON_Input_Boolean(	'o', 			'Approved',		l.review:approved )				OR
					NOT [ g.Module_JSON ].JSON_Input_Number(	'R', 			'Created',		l.review:created,	-1, -1 )	OR
					NOT [ g.Module_JSON ].JSON_Input_Number(	'o', 			'Order_ID',		l.review:order_id,	-1, -1 )	OR
					NOT [ g.Module_JSON ].JSON_Input_Number(	'R', 			'Rating',		l.review:rating,	-1, -1 )	OR
					NOT [ g.Module_JSON ].JSON_Input_Boolean(	'R', 			'Notify',		l.review:notify )				OR
					NOT [ g.Module_JSON ].JSON_Input_Boolean(	'o', 			'Notified',		l.review:notified )				OR
					NOT [ g.Module_JSON ].JSON_Input_Boolean(	'o', 			'Verified',		l.review:verified )				OR
					NOT [ g.Module_JSON ].JSON_Input_Text(		'o', 			'Store_Reply',	l.review:store_rply )			OR
					NOT [ g.Module_JSON ].JSON_Input_Text(		l.fld_name,		'Name',			l.review:name )					OR
					NOT [ g.Module_JSON ].JSON_Input_Text(		l.fld_email,	'Email',		l.review:email )				OR
					NOT [ g.Module_JSON ].JSON_Input_Text(		l.fld_loc,		'Location',		l.review:location )				OR
					NOT [ g.Module_JSON ].JSON_Input_Text(		l.fld_summry,	'Summary',		l.review:summary )				OR
					NOT [ g.Module_JSON ].JSON_Input_Text(		l.fld_title,	'Title',		l.review:title )
				}">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_InputErrors() }">
	</MvIF>

	<MvIF EXPR = "{ l.review:rating EQ 0 }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_FieldError( 'Rating', 'Rating must be between 1-5.' ) }">
	</MvIF>

	<MvIF EXPR = "{ NOT ISNULL l.review:email }">
		<MvIF EXPR = "{ NOT [ g.Module_Admin ].Validate_Email( l.review:email ) }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_FieldError( 'Email', g.Validation_Message ) }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT TGReviewsProduct_Insert( l.review ) }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_Error( g.Error_Code, g.Error_Message ) }">
	</MvIF>

	<MvEVAL EXPR = "{ [ g.Module_Admin ].Admin_Log_Action( '#Error#', 'Added review for \'' $ l.product:id ) }">

	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_Success() }">
</MvFUNCTION>

<MvFUNCTION NAME = "JSON_Load_All_AdditionalFields" PARAMETERS = "module var"  STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<MvIF EXPR = "{ NOT [ g.Module_JSON ].JSON_Store_Open() }">				<MvFUNCTIONRETURN>																	</MvIF>
	<MvIF EXPR = "{ NOT [ g.Module_Admin ].CanI( 'SYSM', 1, 0, 0, 0 ) }">	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_JSON ].JSON_Response_Access_Denied() }">	</MvIF>
	{
		"total_count":	0,
		"start_offset":	0,
		"data":
		[]
	}
</MvFUNCTION>

<MvCOMMENT>
|
|	clientside
|
</MvCOMMENT>

<MvFUNCTION NAME = "Module_Clientside" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ ( '.js' EIN g.Filename ) EQ len_var( g.Filename ) }">
		<MvEVAL EXPR = "{ [ g.Module_Clientside ].Module_Content_Type( l.module, 'text/javascript' ) }">
	</MvIF>

	<MvIF EXPR = "{ Module_Clientside_Output_File( l.module, g.Filename ) }">
		<MvFUNCTIONRETURN>
	</MvIF>

	<MvASSIGN NAME = "l.null"	VALUE = "{ miva_output_header( 'Status', '404 Not Found' ) }">
</MvFUNCTION>

<MvCOMMENT>
|
|	component
|
</MvCOMMENT>

<MvFUNCTION NAME = "ComponentModule_Initialize" PARAMETERS = "module var, item, all_settings var, settings var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ComponentModule_Render_End" PARAMETERS = "module var, item, all_settings var, settings var, param" STANDARDOUTPUTLEVEL = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ComponentModule_Tabs" PARAMETERS = "module var, item, settings var" STANDARDOUTPUTLEVEL = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ComponentModule_Validate" PARAMETERS = "module var, item, field_prefix, fields var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ComponentModule_Update" PARAMETERS = "module var, item, field_prefix, fields var, settings var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ComponentModule_Content" PARAMETERS = "module var, item, tab, load_fields, field_prefix, fields var, settings var" STANDARDOUTPUTLEVEL = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ComponentModule_Defaults" PARAMETERS = "module var, settings var" STANDARDOUTPUTLEVEL = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ComponentModule_Page_Assign" PARAMETERS = "module var, page var, item, settings var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ComponentModule_Page_Unassign" PARAMETERS = "module var, page var, item, settings var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ComponentModule_Prerender" PARAMETERS = "module var, item, all_settings var, settings var, param" STANDARDOUTPUTLEVEL = "">
</MVFUNCTION>

<MvFUNCTION NAME = "ComponentModule_Render_Start" PARAMETERS = "module var, item, settings var, item_settings var, param" STANDARDOUTPUTLEVEL = "">
</MvFUNCTION>

<MvCOMMENT>
| ====================================================================================
|	FIELDS_PROD
| ====================================================================================
</MvCOMMENT>

<MvFUNCTION NAME = "Module_Product_Fields" PARAMETERS = "module var, fields var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Product_Field_Name" PARAMETERS = "module var, code" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Product_Field_Value" PARAMETERS = "module var, product_id, code" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Product_Set_Field" PARAMETERS = "module var, product_id, code, value" STANDARDOUTPUTLEVEL = "">
</MvFUNCTION>

<MvCOMMENT>
| ====================================================================================
|	FULFILL
| ====================================================================================
</MvCOMMENT>

<MvFUNCTION NAME = "FulfillmentModule_ProcessOrder" PARAMETERS = "module var, order var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
| ====================================================================================
| SCHEDULEDTASK
| ====================================================================================
</MvCOMMENT>

<MvFUNCTION NAME = "ScheduledTaskModule_Capabilities" PARAMETERS = "module var, capabilities var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.capabilities:provision_settings" VALUE = 0>
	<MvASSIGN NAME = "l.capabilities:provision" VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "ScheduledTaskModule_Operations" PARAMETERS = "module var, operations var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.operations" INDEX = "1" MEMBER = "code"		VALUE = "tgr_order_emails">
	<MvASSIGN NAME = "l.operations" INDEX = "1" MEMBER = "descrip"	VALUE = "Trigger 'Mail After' Emails for Reviews">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ScheduledTaskModule_Fields" PARAMETERS = "module var, task var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ScheduledTaskModule_Invalid" PARAMETERS = "module var, field_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "ScheduledTaskModule_Prompt" PARAMETERS = "module var, field_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ScheduledTaskModule_Field" PARAMETERS = "module var, field_id" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
</MvFUNCTION>

<MvFUNCTION NAME = "ScheduledTaskModule_Validate" PARAMETERS = "module var, task var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ScheduledTaskModule_Update" PARAMETERS = "module var, task var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ScheduledTaskModule_Delete" PARAMETERS = "module var, task var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ScheduledTaskModule_Execute" PARAMETERS = "module var, task var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', 'Unsupported operation' ) }">
</MvFUNCTION>

<MvFUNCTION NAME = "ScheduledTaskModule_Provision_Settings" PARAMETERS = "module var, task var, provide_xml var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
| ====================================================================================
| VIS_PRODUCT
| ====================================================================================
</MvCOMMENT>

<MvFUNCTION NAME = "Module_Product_Tabs" PARAMETERS = "module var, product var" STANDARDOUTPUTLEVEL = "compresswhitespace">
	<MvFUNCTIONRETURN VALUE = "TGR_PROD:Product Reviews">
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Product_Head" PARAMETERS = "module var, tab, product var" STANDARDOUTPUTLEVEL = "html, text">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Product_Content" PARAMETERS = "module var, tab, load_fields, product var" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Product_Update" PARAMETERS = "module var, product var" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Product_Insert" PARAMETERS = "module var, product var" STANDARDOUTPUTLEVEL = "compresswhitespace">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Product_Delete" PARAMETERS = "module var, product var" STANDARDOUTPUTLEVEL = "compresswhitespace">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Product_Validate" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>


<MvCOMMENT>
| ====================================================================================
|	EXPORT
| ====================================================================================
</MvCOMMENT>

<MvFUNCTION NAME = "ExportModule_Export" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ExportModule_Validate" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ExportModule_Screen" PARAMETERS = "module var" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
| ====================================================================================
|	IMPORT
| ====================================================================================
</MvCOMMENT>

<MvFUNCTION NAME = "ImportModule_Delete" PARAMETERS = "module var, import var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Capabilities" PARAMETERS = "module var, capabilities var" STANDARDOUTPUTLEVEL = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Delimited_Columns" PARAMETERS = "module var, import var, columns var" STANDARDOUTPUTLEVEL = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Persistent_StatusFields" PARAMETERS = "module var, import var, fields var" STANDARDOUTPUTLEVEL = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Delimited_Import_Begin" PARAMETERS = "module var, import var, session var, run_data var" STANDARDOUTPUTLEVEL = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Delimited_Import_Record" PARAMETERS = "module var, import var, session var, record var, run_data var" STANDARDOUTPUTLEVEL = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Delimited_Import_End" PARAMETERS = "module var, import var, session var, run_data var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Persistent_Fields" PARAMETERS = "module var, import var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Persistent_Invalid" PARAMETERS = "module var, field_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 0>
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Persistent_Prompt" PARAMETERS = "module var, field_id" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = "">
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Persistent_Field" PARAMETERS = "module var, field_id" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Persistent_Validate" PARAMETERS = "module var, import var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Persistent_Update" PARAMETERS = "module var, import var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "ImportModule_Persistent_Provision" PARAMETERS = "module var, import var, provide_xml var" STANDARDOUTPUTLEVEL = "">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
|	sNN_TGReviewsGeneralSettings
|
</MvCOMMENT>

<MvFUNCTION NAME = "TGReviewsGeneralSettings_Read" PARAMETERS = "general_settings var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.general_settings:fld_name"		VALUE = "{ TGReviewsGeneralSettings.d.fld_name }">
	<MvASSIGN NAME = "l.general_settings:fld_email"		VALUE = "{ TGReviewsGeneralSettings.d.fld_email }">
	<MvASSIGN NAME = "l.general_settings:fld_loc"		VALUE = "{ TGReviewsGeneralSettings.d.fld_loc }">
	<MvASSIGN NAME = "l.general_settings:fld_summry"	VALUE = "{ TGReviewsGeneralSettings.d.fld_summry }">
	<MvASSIGN NAME = "l.general_settings:fld_title"		VALUE = "{ TGReviewsGeneralSettings.d.fld_title }">
	<MvASSIGN NAME = "l.general_settings:per_page"		VALUE = "{ TGReviewsGeneralSettings.d.per_page }">
	<MvASSIGN NAME = "l.general_settings:sort"			VALUE = "{ TGReviewsGeneralSettings.d.sort }">
	<MvASSIGN NAME = "l.general_settings:auto_apprv"	VALUE = "{ TGReviewsGeneralSettings.d.auto_apprv }">
	<MvASSIGN NAME = "l.general_settings:rc_enabled"	VALUE = "{ TGReviewsGeneralSettings.d.rc_enabled }">
	<MvASSIGN NAME = "l.general_settings:rc_pub_key"	VALUE = "{ TGReviewsGeneralSettings.d.rc_pub_key }">
	<MvASSIGN NAME = "l.general_settings:rc_prv_key"	VALUE = "{ TGReviewsGeneralSettings.d.rc_prv_key }">
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsGeneralSettings_Load" PARAMETERS = "general_settings var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "TGReviewsGeneralSettings"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'TGReviewsGeneralSettings' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvEVAL EXPR = "{ TGReviewsGeneralSettings_Read( l.general_settings ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviewsGeneralSettings">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsGeneralSettings_Load_Cached" PARAMETERS = "general_settings var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCE NAME = "l.cache"						VARIABLE = "g.Session:cache:TGReviewsGeneralSettings_load_cached">

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ TGReviewsGeneralSettings_Load( l.cache:TGReviewsGeneralSettings ) }">
		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.general_settings"				VALUE = "{ l.cache:TGReviewsGeneralSettings }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsGeneralSettings_Insert" PARAMETERS = "general_settings var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'TGReviewsGeneralSettings
							( fld_name, fld_email, fld_loc, fld_summry, fld_title, per_page, sort, auto_apprv, rc_enabled, rc_pub_key, rc_prv_key )
						  VALUES
							( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS = "l.general_settings:fld_name, l.general_settings:fld_email, l.general_settings:fld_loc,
					   l.general_settings:fld_summry, l.general_settings:fld_title, l.general_settings:per_page,
					   l.general_settings:sort, l.general_settings:auto_apprv, l.general_settings:rc_enabled,
					   l.general_settings:rc_pub_key, l.general_settings:rc_prv_key">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsGeneralSettings_Update" PARAMETERS = "general_settings var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'TGReviewsGeneralSettings
			 			  SET
			 				fld_name = ?,
							fld_email = ?,
							fld_loc = ?,
							fld_summry = ?,
							fld_title = ?,
							per_page = ?,
							sort = ?,
							auto_apprv = ?,
							rc_enabled = ?,
							rc_pub_key = ?,
							rc_prv_key = ?' }"
			 FIELDS = "l.general_settings:fld_name, l.general_settings:fld_email, l.general_settings:fld_loc,
					   l.general_settings:fld_summry, l.general_settings:fld_title, l.general_settings:per_page,
					   l.general_settings:sort, l.general_settings:auto_apprv, l.general_settings:rc_enabled,
					   l.general_settings:rc_pub_key, l.general_settings:rc_prv_key">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
|	sNN_TGReviewsNotificationSettings
|
</MvCOMMENT>

<MvFUNCTION NAME = "TGReviewsNotificationSettings_Read" PARAMETERS = "notification_settings var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.notification_settings:ma_enable"	VALUE = "{ TGReviewsNotificationSettings.d.ma_enable }">
	<MvASSIGN NAME = "l.notification_settings:ma_days"		VALUE = "{ TGReviewsNotificationSettings.d.ma_days }">
	<MvASSIGN NAME = "l.notification_settings:ma_after"		VALUE = "{ TGReviewsNotificationSettings.d.ma_after }">
	<MvASSIGN NAME = "l.notification_settings:ma_from"		VALUE = "{ TGReviewsNotificationSettings.d.ma_from }">
	<MvASSIGN NAME = "l.notification_settings:ma_cc"		VALUE = "{ TGReviewsNotificationSettings.d.ma_cc }">
	<MvASSIGN NAME = "l.notification_settings:ma_bcc"		VALUE = "{ TGReviewsNotificationSettings.d.ma_bcc }">
	<MvASSIGN NAME = "l.notification_settings:ma_subject"	VALUE = "{ TGReviewsNotificationSettings.d.ma_subject }">
	<MvASSIGN NAME = "l.notification_settings:mn_enable"	VALUE = "{ TGReviewsNotificationSettings.d.mn_enable }">
	<MvASSIGN NAME = "l.notification_settings:mn_to"		VALUE = "{ TGReviewsNotificationSettings.d.mn_to }">
	<MvASSIGN NAME = "l.notification_settings:mn_from"		VALUE = "{ TGReviewsNotificationSettings.d.mn_from }">
	<MvASSIGN NAME = "l.notification_settings:mn_cc"		VALUE = "{ TGReviewsNotificationSettings.d.mn_cc }">
	<MvASSIGN NAME = "l.notification_settings:mn_bcc"		VALUE = "{ TGReviewsNotificationSettings.d.mn_bcc }">
	<MvASSIGN NAME = "l.notification_settings:mn_subject"	VALUE = "{ TGReviewsNotificationSettings.d.mn_subject }">
	<MvASSIGN NAME = "l.notification_settings:cn_from"		VALUE = "{ TGReviewsNotificationSettings.d.cn_from }">
	<MvASSIGN NAME = "l.notification_settings:cn_cc"		VALUE = "{ TGReviewsNotificationSettings.d.cn_cc }">
	<MvASSIGN NAME = "l.notification_settings:cn_bcc"		VALUE = "{ TGReviewsNotificationSettings.d.cn_bcc }">
	<MvASSIGN NAME = "l.notification_settings:cn_subject"	VALUE = "{ TGReviewsNotificationSettings.d.cn_subject }">
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsNotificationSettings_Load" PARAMETERS = "notification_settings var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "TGReviewsNotificationSettings"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'TGReviewsNotificationSettings' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvEVAL EXPR = "{ TGReviewsNotificationSettings_Read( l.notification_settings ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviewsNotificationSettings">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsNotificationSettings_Load_Cached" PARAMETERS = "notification_settings var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCE NAME = "l.cache"						VARIABLE = "g.Session:cache:TGReviewsNotificationSettings_load_cached">

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ TGReviewsNotificationSettings_Load( l.cache:TGReviewsNotificationSettings ) }">
		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.notification_settings"			VALUE = "{ l.cache:TGReviewsNotificationSettings }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsNotificationSettings_Insert" PARAMETERS = "notification_settings var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'TGReviewsNotificationSettings
							( ma_enable, ma_days, ma_after, ma_from, ma_cc, ma_bcc, ma_subject, mn_enable, mn_to, mn_from, mn_cc, mn_bcc, mn_subject, cn_from, cn_cc, cn_bcc, cn_subject )
						  VALUES
							( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS = "l.notification_settings:ma_enable, l.notification_settings:ma_days, l.notification_settings:ma_after,
					   l.notification_settings:ma_from, l.notification_settings:ma_cc, l.notification_settings:ma_bcc,
					   l.notification_settings:ma_subject, l.notification_settings:mn_enable, l.notification_settings:mn_to,
					   l.notification_settings:mn_from, l.notification_settings:mn_cc, l.notification_settings:mn_bcc,
					   l.notification_settings:mn_subject, l.notification_settings:cn_from, l.notification_settings:cn_cc,
					   l.notification_settings:cn_bcc, l.notification_settings:cn_subject">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsNotificationSettings_Update" PARAMETERS = "notification_settings var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'TGReviewsNotificationSettings
			 			  SET
			 				ma_enable = ?,
							ma_days = ?,
							ma_after = ?,
							ma_from = ?,
							ma_cc = ?,
							ma_bcc = ?,
							ma_subject = ?,
							mn_enable = ?,
							mn_to = ?,
							mn_from = ?,
							mn_cc = ?,
							mn_bcc = ?,
							mn_subject = ?,
							cn_from = ?,
							cn_cc = ?,
							cn_bcc = ?,
							cn_subject = ?' }"
			 FIELDS = "l.notification_settings:ma_enable, l.notification_settings:ma_days, l.notification_settings:ma_after,
					   l.notification_settings:ma_from, l.notification_settings:ma_cc, l.notification_settings:ma_bcc,
					   l.notification_settings:ma_subject, l.notification_settings:mn_enable, l.notification_settings:mn_to,
					   l.notification_settings:mn_from, l.notification_settings:mn_cc, l.notification_settings:mn_bcc,
					   l.notification_settings:mn_subject, l.notification_settings:cn_from, l.notification_settings:cn_cc,
					   l.notification_settings:cn_bcc, l.notification_settings:cn_subject">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
|	sNN_TGReviewsTemplates
|
</MvCOMMENT>

<MvFUNCTION NAME = "TGReviewsTemplates_Read" PARAMETERS = "templates var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.templates:ma_tmpl_id"	VALUE = "{ TGReviewsTemplates.d.ma_tmpl_id }">
	<MvASSIGN NAME = "l.templates:mn_tmpl_id"	VALUE = "{ TGReviewsTemplates.d.mn_tmpl_id }">
	<MvASSIGN NAME = "l.templates:cn_tmpl_id"	VALUE = "{ TGReviewsTemplates.d.cn_tmpl_id }">
	<MvASSIGN NAME = "l.templates:form_tmpl"	VALUE = "{ TGReviewsTemplates.d.form_tmpl }">
	<MvASSIGN NAME = "l.templates:rvws_tmpl"	VALUE = "{ TGReviewsTemplates.d.rvws_tmpl }">
	<MvASSIGN NAME = "l.templates:prlog_tmpl"	VALUE = "{ TGReviewsTemplates.d.prlog_tmpl }">
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsTemplates_Load" PARAMETERS = "templates var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "TGReviewsTemplates"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'TGReviewsTemplates' }">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvEVAL EXPR = "{ TGReviewsTemplates_Read( l.templates ) }">

	<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviewsTemplates">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsTemplates_Load_Cached" PARAMETERS = "templates var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCE NAME = "l.cache"						VARIABLE = "g.Session:cache:TGReviewsTemplates_load_cached">

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ TGReviewsTemplates_Load( l.cache:TGReviewsTemplates ) }">
		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.templates"						VALUE = "{ l.cache:TGReviewsTemplates }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsTemplates_Insert" PARAMETERS = "templates var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'TGReviewsTemplates
							( ma_tmpl_id, mn_tmpl_id, cn_tmpl_id, form_tmpl, rvws_tmpl, prlog_tmpl )
						  VALUES
							( ?, ?, ?, ?, ?, ? )' }"
			 FIELDS = "l.templates:ma_tmpl_id, l.templates:mn_tmpl_id, l.templates:cn_tmpl_id, l.templates:form_tmpl, l.templates:rvws_tmpl, l.templates:prlog_tmpl">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsTemplates_Update" PARAMETERS = "settings var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'TGReviewsTemplates
			 			  SET
							ma_tmpl_id = ?,
							mn_tmpl_id = ?,
							cn_tmpl_id = ?,
							form_tmpl = ?,
							rvws_tmpl = ?,
							prlog_tmpl = ?' }"
			 FIELDS = "l.templates:ma_tmpl_id, l.templates:mn_tmpl_id, l.templates:cn_tmpl_id, l.templates:form_tmpl, l.templates:rvws_tmpl, l.templates:prlog_tmpl">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
|	sNN_TGReviewsProducts
|
</MvCOMMENT>

<MvFUNCTION NAME = "TGReviewsProduct_Read" PARAMETERS = "review var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.review:id"			VALUE = "{ TGReviewsProducts.d.id }">
	<MvASSIGN NAME = "l.review:created"		VALUE = "{ TGReviewsProducts.d.created }">
	<MvASSIGN NAME = "l.review:product_id"	VALUE = "{ TGReviewsProducts.d.product_id }">
	<MvASSIGN NAME = "l.review:cust_id"		VALUE = "{ TGReviewsProducts.d.cust_id }">
	<MvASSIGN NAME = "l.review:order_id"	VALUE = "{ TGReviewsProducts.d.order_id }">
	<MvASSIGN NAME = "l.review:approved"	VALUE = "{ TGReviewsProducts.d.approved }">
	<MvASSIGN NAME = "l.review:rating"		VALUE = "{ TGReviewsProducts.d.rating }">
	<MvASSIGN NAME = "l.review:name"		VALUE = "{ TGReviewsProducts.d.name }">
	<MvASSIGN NAME = "l.review:email"		VALUE = "{ TGReviewsProducts.d.email }">
	<MvASSIGN NAME = "l.review:location"	VALUE = "{ TGReviewsProducts.d.location }">
	<MvASSIGN NAME = "l.review:notify"		VALUE = "{ TGReviewsProducts.d.notify }">
	<MvASSIGN NAME = "l.review:title"		VALUE = "{ TGReviewsProducts.d.title }">
	<MvASSIGN NAME = "l.review:summary"		VALUE = "{ TGReviewsProducts.d.summary }">
	<MvASSIGN NAME = "l.review:store_rply"	VALUE = "{ TGReviewsProducts.d.store_rply }">
	<MvASSIGN NAME = "l.review:notified"	VALUE = "{ TGReviewsProducts.d.notified }">
	<MvASSIGN NAME = "l.review:verified"	VALUE = "{ TGReviewsProducts.d.verified }">
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsProduct_Load" PARAMETERS = "id, review var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "TGReviewsProducts"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'TGReviewsProducts WHERE id = ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ TGReviewsProducts.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviewsProducts">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( '#Error#' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ TGReviewsProduct_Read( l.review ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviewsProducts">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsProduct_Insert" PARAMETERS = "review var" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">
	
	<MvIF EXPR = "{ NOT TGReviewsProduct_Insert_LowLevel( l.review ) OR
					NOT TGReviewsAdditionalValues_InsertUpdate( l.review ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsProduct_Insert_LowLevel" PARAMETERS = "review var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.review:id" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'TGRProduct' ) }">

	<MvIF EXPR = "{ ISNULL l.review:created }">		<MvASSIGN NAME = "l.review:created"		VALUE = "{ s.dyn_time_t }"> </MvIF>
	<MvIF EXPR = "{ ISNULL l.review:product_id }">	<MvASSIGN NAME = "l.review:product_id"	VALUE = 0> </MvIF>
	<MvIF EXPR = "{ ISNULL l.review:cust_id }">		<MvASSIGN NAME = "l.review:cust_id"		VALUE = 0> </MvIF>
	<MvIF EXPR = "{ ISNULL l.review:order_id }">	<MvASSIGN NAME = "l.review:order_id"	VALUE = 0> </MvIF>
	<MvIF EXPR = "{ ISNULL l.review:approved }">	<MvASSIGN NAME = "l.review:approved"	VALUE = 0> </MvIF>
	<MvIF EXPR = "{ ISNULL l.review:rating }">		<MvASSIGN NAME = "l.review:rating"		VALUE = 0> </MvIF>
	<MvIF EXPR = "{ ISNULL l.review:notify }">		<MvASSIGN NAME = "l.review:notify"		VALUE = 0> </MvIF>
	<MvIF EXPR = "{ ISNULL l.review:notified }">	<MvASSIGN NAME = "l.review:notified"	VALUE = 0> </MvIF>
	<MvIF EXPR = "{ ISNULL l.review:verified }">	<MvASSIGN NAME = "l.review:verified"	VALUE = 0> </MvIF>

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'TGReviewsProducts
							( id, created, product_id, cust_id, order_id, approved, rating, name, email, location, notify, title, summary, store_rply, notified, verified )
						  VALUES
							( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )' }"
			 FIELDS	= "l.review:id, l.review:created, l.review:product_id, l.review:cust_id, l.review:order_id,
					   l.review:approved, l.review:rating, l.review:name, l.review:email, l.review:location, l.review:notify,
					   l.review:title, l.review:summary, l.review:store_rply, l.review:notified, l.review:verified">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsProduct_Update" PARAMETERS = "review var" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">
	
	<MvIF EXPR = "{ NOT TGReviewsProduct_Update_LowLevel( l.review ) OR
					NOT TGReviewsAdditionalValues_InsertUpdate( l.review ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsProduct_Update_LowLevel" PARAMETERS = "review var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'TGReviewsProducts
			 			  SET
							created = ?,
							product_id = ?,
							cust_id = ?,
							order_id = ?,
							approved = ?,
							rating = ?,
							name = ?,
							email = ?,
							location = ?,
							notify = ?,
							title = ?,
							summary = ?,
							store_rply = ?,
							notified = ?,
							verified = ?
			 			  WHERE
			 				id	= ?' }"
			 FIELDS = "l.review:created, l.review:product_id, l.review:cust_id, l.review:order_id, l.review:approved,
					   l.review:rating, l.review:name, l.review:email, l.review:location, l.review:notify, l.review:title,
					   l.review:summary, l.review:store_rply, l.review:notified, l.review:verified, l.review:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsProduct_Delete" PARAMETERS = "review var" STANDARDOUTPUTLEVEL = "">
	<MvTRANSACT NAME = "Merchant">
	
	<MvIF EXPR = "{ NOT TGReviewsProduct_Delete_LowLevel( l.review ) OR
					NOT TGReviewsAdditionalValues_Delete_Review( l.review:id ) }">
		<MvROLLBACK NAME = "Merchant">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvCOMMIT NAME = "Merchant">
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsProduct_Delete_LowLevel" PARAMETERS = "review var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'TGReviewsProducts WHERE id = ?' }"
			 FIELDS	= "l.review:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
|	sNN_TGReviewsAdditionalFields
|
</MvCOMMENT>

<MvFUNCTION NAME = "TGReviewsAdditionalField_Read" PARAMETERS = "additionalfield var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.additionalfield:id"		VALUE = "{ TGReviewsAdditionalFields.d.id }">
	<MvASSIGN NAME = "l.additionalfield:code"	VALUE = "{ TGReviewsAdditionalFields.d.code }">
	<MvASSIGN NAME = "l.additionalfield:name"	VALUE = "{ TGReviewsAdditionalFields.d.name }">
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalField_Load_ID" PARAMETERS = "id, additionalfield var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "TGReviewsAdditionalFields"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields WHERE id = ?' }"
				FIELDS	= "l.id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ TGReviewsAdditionalFields.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviewsAdditionalFields">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( '#Error#' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ TGReviewsAdditionalField_Read( l.additionalfield ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviewsAdditionalFields">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalField_Load_ID_Cached" PARAMETERS = "id, additionalfield var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.id"								VALUE = "{ int( l.id ) }">

	<MvIF EXPR = "{ l.id LE 0 }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( '#Error#' ) }">
	</MvIF>

	<MvREFERENCEARRAY NAME = "l.cache"					VARIABLE = "g.Session:cache:tgreviewsadditionalfield_load_id_cached">
		<MvDIMENSION INDEX = "{ l.id }">
	</MvREFERENCEARRAY>

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result" 				VALUE = "{ TGReviewsAdditionalField_Load_ID( l.id, l.cache:additionalfield ) }">
		<MvIF EXPR = "{ NOT l.cache:result }">
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE =  "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.additionalfield"				VALUE = "{ l.cache:additionalfield }">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalField_Load_Code" PARAMETERS = "code, additionalfield var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "TGReviewsAdditionalFields"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields WHERE ' $ [ g.Library_Filename_Native_DBAPI ].DB_Compare_UPPER( 'code' ) $ ' = ' $ [ g.Library_Filename_Native_DBAPI ].DB_Compare_UPPER( '?' ) }"
				FIELDS	= "l.code">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Library_Filename_Utilities ].Error( '#Error#', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ TGReviewsAdditionalFields.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviewsAdditionalFields">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( '#Error#' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ TGReviewsAdditionalField_Read( l.product ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviewsAdditionalFields">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalField_Load_Code_Cached" PARAMETERS = "code, additionalfield var" STANDARDOUTPUTLEVEL = "">
	<MvREFERENCEARRAY NAME = "l.cache" 					VARIABLE = "g.Session:cache:tgreviewsadditionalfield_load_code_cached">
		<MvMEMBER NAME = "{ l.code }">
	</MvREFERENCEARRAY>

	<MvIF EXPR = "{ ISNULL l.cache:result }">
		<MvASSIGN NAME = "l.cache:result"				VALUE = "{ TGReviewsAdditionalField_Load_Code( l.code, l.cache:additionalfield ) }">

		<MvIF EXPR = "{ l.cache:result }">
			<MvREFERENCE NAME = "g.Session:cache:tgreviewsadditionalfield_load_id_cached" INDEX = "{ l.cache:additionalfield:id }" VARIABLE = "l.cache">
		<MvELSE>
			<MvASSIGN NAME = "l.cache:error_code"		VALUE = "{ g.Error_Code }">
			<MvASSIGN NAME = "l.cache:error_message"	VALUE = "{ g.Error_Message }">
			<MvASSIGN NAME = "l.cache:error_db_eof"		VALUE = "{ g.Error_DB_EOF }">
		</MvIF>
	</MvIF>

	<MvIF EXPR = "{ NOT l.cache:result }">
		<MvIF EXPR = "{ l.cache:error_db_eof }">
			<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( l.cache:error_code ) }">
		</MvIF>

		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( l.cache:error_code, l.cache:error_message ) }">
	</MvIF>

	<MvASSIGN NAME = "l.additionalfield"				VALUE = "{ l.cache:additionalfield }">

	<MvFUNCTIONRETURN VALUE = "{ l.cache:result }">
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalField_Insert" PARAMETERS = "additionalfield var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.additionalfield:id" VALUE = "{ [ g.Module_Library_DB ].StoreKey_Generate( 'TGRAdditional' ) }">

	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields
							( id, code, name )
						  VALUES
							( ?, ?, ? )' }"
			 FIELDS	= "l.additionalfield:id, l.additionalfield:code, l.additionalfield:name">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalField_Update" PARAMETERS = "additionalfield var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields
			 			  SET
							code = ?,
							name = ?
			 			  WHERE
			 				id	= ?' }"
			 FIELDS = "l.additionalfield:code, l.additionalfield:name, l.additionalfield:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalField_Delete" PARAMETERS = "additionalfield var" STANDARDOUTPUTLEVEL = "">	
	<MvIF EXPR = "{ NOT TGReviewsAdditionalField_Delete_LowLevel( l.additionalfield ) OR
					NOT TGReviewsAdditionalValues_Delete_Field( l.additionalfield:id ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalField_Delete_LowLevel" PARAMETERS = "additionalfield var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalFields WHERE id = ?' }"
			 FIELDS	= "l.additionalfield:id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
|	sNN_TGReviewsAdditionalValues
|
</MvCOMMENT>

<MvFUNCTION NAME = "TGReviewsAdditionalValue_Read" PARAMETERS = "additionalvalue var" STANDARDOUTPUTLEVEL = "">
	<MvASSIGN NAME = "l.additionalvalue:field_id"	VALUE = "{ TGReviewsAdditionalValue.d.field_id }">
	<MvASSIGN NAME = "l.additionalvalue:review_id"	VALUE = "{ TGReviewsAdditionalValue.d.review_id }">
	<MvASSIGN NAME = "l.additionalvalue:value"		VALUE = "{ TGReviewsAdditionalValue.d.value }">

	<MvCOMMENT>
	|
	|	For backwards compatibility
	|
	</MvCOMMENT>

	<MvASSIGN NAME = "l.additionalvalue:rating_id" VALUE = "{ l.additionalvalue:review_id }">
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalValue_Load" PARAMETERS = "additionalvalue var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvOPENVIEW NAME	= "Merchant"
				VIEW	= "TGReviewsAdditionalValues"
				QUERY	= "{ 'SELECT * FROM ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues WHERE field_id = ? AND review_id = ?' }"
				FIELDS	= "l.additionalvalue:field_id, l.additionalvalue:review_id">
	<MvIF EXPR = "{ g.MvOPENVIEW_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvOPENVIEW_Error ) }">
	</MvIF>

	<MvIF EXPR = "{ TGReviewsAdditionalValues.d.EOF }">
		<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviewsAdditionalValues">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_DB ].Error_Load_EOF( '#Error#' ) }">
	</MvIF>

	<MvEVAL EXPR = "{ TGReviewsAdditionalValue_Read( l.additionalvalue ) }">
	<MvCLOSEVIEW NAME = "Merchant" VIEW = "TGReviewsAdditionalValues">

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalValue_Insert" PARAMETERS = "additionalvalue var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'INSERT INTO ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues
							( field_id, review_id, value )
						  VALUES
							( ?, ?, ? )' }"
			 FIELDS	= "l.additionalvalue:field_id, l.additionalvalue:review_id, l.additionalvalue:value">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalValues_InsertUpdate" PARAMETERS = "review var" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ ISNULL l.review:additional_fields }">
		<MvFUNCTIONRETURN VALUE = 1>
	</MvIF>

	<MvFOREACH ITERATOR = "l.additionalfield_code" ARRAY = "l.additionalfields" COUNT = "{ miva_struct_members( l.review:additional_fields, l.additionalfields ) }">
		<MvIF EXPR = "{ NOT TGReviewsAdditionalField_Load_Code_Cached( l.additionalfield_code, l.additionalfield ) }">
			<MvFOREACHCONTINUE>
		</MvIF>

		<MvASSIGN NAME = "l.additionalvalue:field_id"	VALUE = "{ l.additionalfield:id }">
		<MvASSIGN NAME = "l.additionalvalue:review_id"	VALUE = "{ l.review:id }">
		<MvASSIGN NAME = "l.additionalvalue:value"		VALUE = "{ miva_variable_value( 'l.review:additional_fields:' $ l.additionalfield_code) }">

		<MvIF EXPR = "{ NOT TGReviewsAdditionalValue_Insert( l.additionalvalue ) }">
			<MvIF EXPR = "{ NOT [ g.Module_Library_Native_DBAPI ].DB_Error_IsIndexDuplicate( g.Error_Message ) }">	<MvFUNCTIONRETURN VALUE = 0>
			<MvELSEIF EXPR = "{ NOT TGReviewsAdditionalValue_Update( l.additionalvalue ) }">						<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>
		</MvIF>
	</MvFOREACH>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalValue_Update" PARAMETERS = "additionalvalue var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME 	= "Merchant"
			 QUERY 	= "{ 'UPDATE ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues
			 			  SET
							value = ?,
			 			  WHERE
							field_id = ? AND
							review_id = ?' }"
			 FIELDS = "l.additionalvalue:value, l.additionalvalue:field_id, l.additionalvalue:review_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalValue_Delete" PARAMETERS = "additionalvalue var" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues WHERE field_id = ? AND review_id = ?' }"
			 FIELDS	= "l.additionalvalue:field_id, l.additionalvalue:review_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalValues_Delete_Field" PARAMETERS = "field_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues WHERE field_id = ?' }"
			 FIELDS	= "l.field_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "TGReviewsAdditionalValues_Delete_Review" PARAMETERS = "review_id" STANDARDOUTPUTLEVEL = "" ERROROUTPUTLEVEL = "">
	<MvQUERY NAME	= "Merchant"
			 QUERY	= "{ 'DELETE FROM ' $ g.Store_Table_Prefix $ 'TGReviewsAdditionalValues WHERE review_id = ?' }"
			 FIELDS	= "l.review_id">
	<MvIF EXPR = "{ g.MvQUERY_Error }">
		<MvFUNCTIONRETURN VALUE = "{ [ g.Module_Library_Utilities ].Error( '#Error#', g.MvQUERY_Error ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvCOMMENT>
|
|	System Module Content: Template Helper Function
|
</MvCOMMENT>

<MvFUNCTION NAME = "Admin_Template" PARAMETERS = "name, field_prefix, template_id, load_fields" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<MvIF EXPR = "{ miva_variable_value( 'g.' $ l.field_prefix $ 'template_clear_history' ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_DB ].ManagedTemplate_Delete_History( l.template_id ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	
		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_DB ].ManagedTemplateVersion_Load_Template_Current( l.template_id, l.template ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	
		<MvASSIGN NAME = "{ l.field_prefix $ 'template_version' }"				VALUE = "{ l.template:id }">
		<MvASSIGN NAME = "{ l.field_prefix $ 'template_version_selected' }"		VALUE = "{ l.template:id }">
	<MvELSEIF EXPR = "{ miva_variable_value( 'g.' $ l.field_prefix $ 'template_recall' ) }">
		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_DB ].ManagedTemplateVersion_Load_ID(  miva_variable_value( 'g.' $ l.field_prefix $ 'template_version_selected' ), l.template ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	
		<MvASSIGN NAME = "l.template_id"										VALUE = "{ l.template_id }">
		<MvASSIGN NAME = "l.template_id"										VALUE = "{ l.template_id }">
	
		<MvASSIGN NAME = "l.load_fields"										VALUE = 1>
	<MvELSE>
		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_DB ].ManagedTemplateVersion_Load_Template_Current( l.template_id, l.template ) }">
			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>
	</MvIF>
	
	<MvASSIGN NAME = "{ 'g.' $ l.field_prefix $ 'notes' }"						VALUE = "">

	<MvIF EXPR = "{ g.Data_Entry_Error AND NOT ISNULL miva_variable_value( 'g.' $ l.field_prefix $ 'template_code' ) }">
		<MvASSIGN NAME = "{ 'g.' $ l.field_prefix $ 'template_code' }"			VALUE = "{ miva_variable_value( 'g.' $ l.field_prefix $ 'template_code' ) }">
	<MvELSE>
		<MvASSIGN NAME = "{ 'g.' $ l.field_prefix $ 'template_code' }"			VALUE = "{ l.template:source }">
	</MvIF>
	
	<MvASSIGN NAME = "{ 'g.' $ l.field_prefix $ 'template_version' }"			VALUE = "{ l.template:id }">
	<MvASSIGN NAME = "{ 'g.' $ l.field_prefix $ 'template_version_selected' }"	VALUE = "{ l.template:id }">
	
	<tr>
		<td colspan="2" width="100%">
			<MvEVAL EXPR = "{ [ g.Module_Library_Utilities ].DrawTemplateTextArea( l.field_prefix $ 'template_code', miva_variable_value( 'g.' $  l.field_prefix $ 'template_code' ), 20, 100 ) }">
		</td>
	</tr>
	<tr>
		<td>
			Notes:
		</td>
		<td width="100%">
			<input type="text" name="{ encodeentities( l.field_prefix ) $ 'notes' }" value="{ encodeentities( miva_variable_value( 'g.' $  l.field_prefix $ 'notes' ) ) }" size="40">
		</td>
	</tr>
	<tr>
		<td>
			Versions:
		</td>
		<td width="100%">
			<input type="hidden" name="{ encodeentities( l.field_prefix ) $ 'template_recall' }" value="0">
			<input type="hidden" name="{ encodeentities( l.field_prefix ) $ 'template_clear_history' }" value="0">
			<MvEVAL EXPR = "{ [ g.Module_Feature_TUI_AD ].TUI_Hide_ComponentFields( l.field_prefix, 'template_version' ) }">
			<MvEVAL EXPR = "{ [ g.Module_Feature_TUI_MGR ].TemplateManager_ManagedTemplate_Version_Select( l.template_id, l.field_prefix $ 'template_version_selected', miva_variable_value( 'g.' $ l.field_prefix $ 'template_version_selected' ) ) }">
			<a href="#" onclick="{ 'Toggle( \'' $ [ g.Module_Admin ].JavaScriptEncode( l.field_prefix ) $ 'template_recall' $ '\', 1 ); return false;' }">Recall</a>
			<a href="#" onclick="{ 'Toggle_Prompt( \'Are you sure you wish to delete all templates for ' $ l.name $ '?\\r\\nThis action cannot be undone.\', \'' $ [ g.Module_Admin ].JavaScriptEncode( l.field_prefix ) $ 'template_clear_history' $ '\', 1 ); return false;' }">Clear History</a>
		</td>
	</tr>
</MvFUNCTION>

<MvFUNCTION NAME = "Admin_Template_Update" PARAMETERS = "module var, name, field_prefix, template_id" STANDARDOUTPUTLEVEL = "text, html, compresswhitespace">
	<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_DB ].ManagedTemplateVersion_Load_ID( miva_variable_value( 'g.' $ l.field_prefix $ 'template_version' ), l.template ) OR
					NOT [ g.Module_Feature_TUI_DB ].ManagedTemplate_Load_ID( l.template_id, l.managedtemplate ) }">
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>

	<MvIF EXPR = "{ crypto_md5( miva_variable_value( 'g.' $ l.field_prefix $ 'template_code' ) ) EQ crypto_md5( l.template:source ) }">
		<MvIF EXPR = "{ l.template:id NE l.managedtemplate:current_id }">
			<MvASSIGN NAME = "l.managedtemplate:current_id"	VALUE = "{ l.template:id }">

			<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_MGR ].TemplateManager_Revert_ManagedTemplateVersion( l.managedtemplate, l.template, l.compile_error ) }">
				<MvIF EXPR = "{ len( l.compile_error ) }">
					<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', l.field_prefix $ 'template_code', l.compile_error ) }">
					<MvFUNCTIONRETURN VALUE = 1>
				</MvIF>

				<MvFUNCTIONRETURN VALUE = 0>
			</MvIF>

			<MvEVAL EXPR = "{ [ g.Module_Admin ].Admin_Log_Action( '#Error#', l.module:name $ ' ' $ l.name $ ' template reverted' ) }">
		</MvIF>
	<MvELSE>
		<MvIF EXPR = "{ NOT [ g.Module_Feature_TUI_MGR ].TemplateManager_Create_ManagedTemplateVersion( l.managedtemplate, miva_variable_value( 'g.' $ l.field_prefix $ 'notes' ), miva_variable_value( 'g.' $ l.field_prefix $ 'template_code' ), l.settings, l.compile_error ) }">
			<MvIF EXPR = "{ len( l.compile_error ) }">
				<MvASSIGN NAME = "l.null" VALUE = "{ [ g.Module_Admin ].FieldError( 'TGR_SETT', l.field_prefix $ 'template_code', l.compile_error ) }">
				<MvFUNCTIONRETURN VALUE = 1>
			</MvIF>

			<MvFUNCTIONRETURN VALUE = 0>
		</MvIF>

		<MvEVAL EXPR = "{ [ g.Module_Admin ].Admin_Log_Action( '#Error#',  l.module:name $ ' ' $ l.name $ ' template updated' ) }">
	</MvIF>

	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>

<MvFUNCTION NAME = "Admin_Formatted_Item_Function" PARAMETERS = "function_name, parameters" STANDARDOUTPUTLEVEL = "html, text">
<div style="background: #ffffff; overflow:auto;width:auto;padding:.2em 0;">
<pre style="margin: 0; line-height: 125%;"><span style="color: #446fbd">&lt;mvt:item</span> <span style="color: #6d8600">name=</span><span style="color: #535353">&quot;tgreviews&quot;</span> <span style="color: #6d8600">param=</span><span style="color: #535353">&quot;<span style="color: #446fbd"><MvEVAL EXPR = "{ l.function_name }"></span>(<MvEVAL EXPR = "{ l.parameters }">)&quot;</span> <span style="color: #446fbd">/&gt;</span></pre>
</div>
</MvFUNCTION>

<MvFUNCTION NAME = "Module_Clientside_Output_File" PARAMETERS = "module var, filename" STANDARDOUTPUTLEVEL = "">
	<MvIF EXPR = "{ l.filename EQ 'functions.js' }">
		<MIVA STANDARDOUTPUTLEVEL = "text, html"><MvINCLUDE INTERPRET = "off" FILE = "js/functions.js"><MIVA STANDARDOUTPUTLEVEL = "">
	<MvELSEIF EXPR = "{ l.filename EQ 'productlookupcolumn.js' }">
		<MIVA STANDARDOUTPUTLEVEL = "text, html"><MvINCLUDE INTERPRET = "off" FILE = "js/productlookupcolumn.js"><MIVA STANDARDOUTPUTLEVEL = "">
	<MvELSEIF EXPR = "{ l.filename EQ 'productreviewlist.js' }">
		<MIVA STANDARDOUTPUTLEVEL = "text, html"><MvINCLUDE INTERPRET = "off" FILE = "js/productreviewlist.js"><MIVA STANDARDOUTPUTLEVEL = "">
	<MvELSEIF EXPR = "{ l.filename EQ 'additionalfieldlist.js' }">
		<MIVA STANDARDOUTPUTLEVEL = "text, html"><MvINCLUDE INTERPRET = "off" FILE = "js/additionalfieldlist.js"><MIVA STANDARDOUTPUTLEVEL = "">
	<MvELSE>
		<MvFUNCTIONRETURN VALUE = 0>
	</MvIF>
	
	<MvFUNCTIONRETURN VALUE = 1>
</MvFUNCTION>
